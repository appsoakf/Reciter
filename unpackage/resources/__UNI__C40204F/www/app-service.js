if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((o=>t.resolve(e()).then((()=>o))),(o=>t.resolve(e()).then((()=>{throw o}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...o){uni.__log__?uni.__log__(e,t,...o):console[e].apply(console,[...o,t])}const o="reciter_words";let a=null,n=0;const r=(e=!1)=>new Promise((a=>{try{const r=uni.getStorageSync(o);if(!r)return t("log","at services/word.js:27","本地存储中没有单词数据，返回空数组"),e||i(0),void a([]);try{const o=JSON.parse(r);if(o&&"object"==typeof o&&!0===o.forceEmpty)return t("log","at services/word.js:38","检测到forceEmpty标志，返回空数组"),e||i(0),void a([]);if(Array.isArray(o))return t("log","at services/word.js:47","读取到数组格式数据，长度:",o.length),e||i(o.length),void a(o);if(o&&"object"==typeof o&&Array.isArray(o.words))return t("log","at services/word.js:53","读取到对象格式数据，words长度:",o.words.length),e||i(o.words.length),void a(o.words);t("warn","at services/word.js:60","存储的数据格式无法识别，返回空数组"),e||i(0),a([])}catch(n){t("error","at services/word.js:64","解析单词数据失败:",n),e||i(0),a([])}}catch(r){t("error","at services/word.js:69","获取单词列表出错:",r),e||i(0),a([])}})),s=()=>{try{const a=uni.getStorageSync(o);if(!a)return t("log","at services/word.js:87","同步方法：本地存储中没有单词数据，返回空数组"),[];try{const e=JSON.parse(a);return e&&"object"==typeof e&&!0===e.forceEmpty?(t("log","at services/word.js:96","同步方法检测到forceEmpty标志，返回空数组"),[]):Array.isArray(e)?(t("log","at services/word.js:103","同步方法读取到数组格式数据，长度:",e.length),e):e&&"object"==typeof e&&Array.isArray(e.words)?(t("log","at services/word.js:107","同步方法读取到对象格式数据，words长度:",e.words.length),e.words):(t("warn","at services/word.js:112","同步方法：存储的数据格式无法识别，返回空数组"),[])}catch(e){return t("error","at services/word.js:115","解析单词数据失败:",e),[]}}catch(a){return t("error","at services/word.js:119","获取单词列表出错:",a),[]}},l=e=>new Promise((a=>{const n="string"==typeof e?Number(e):e;try{const e=uni.getStorageSync(o);if(e)try{const o=JSON.parse(e);if(o&&"object"==typeof o&&!0===o.forceEmpty)return t("log","at services/word.js:141","getWordById检测到forceEmpty标志，返回null"),void a(null)}catch(r){t("error","at services/word.js:146","解析存储数据失败:",r)}if(e)try{const t=JSON.parse(e),o=Array.isArray(t)?t:t&&Array.isArray(t.words)?t.words:null;if(o){const e=o.find((e=>e.id===n));if(e)return void a(e)}}catch(r){t("error","at services/word.js:168","解析单词数据失败:",r)}a(null)}catch(s){t("error","at services/word.js:175","获取单词详情出错:",s),a(null)}})),i=e=>{if("undefined"!=typeof uni&&uni.$emit){if(a===e)return void t("log","at services/word.js:242","跳过相同数量的通知:",e);const o=Date.now();if(o-n<300)return void t("log","at services/word.js:249","通知频率过高，跳过本次通知");t("log","at services/word.js:253","发送单词数量更新事件，当前数量:",e),a=e,n=o,uni.$emit("words-count-updated",{count:e}),uni.$emit("global-data-updated")}},d=(e,a)=>(t("log","at services/word.js:307",`准备更新ID为${e}的单词`,a),new Promise(((n,r)=>{try{const d=uni.getStorageSync(o);if(!d)return t("error","at services/word.js:314","更新单词失败：未找到本地存储的单词数据"),void r(new Error("未找到本地存储的单词数据"));try{let i,c=JSON.parse(d),u=!1;if(Array.isArray(c))t("log","at services/word.js:327","检测到旧格式存储数据（数组）"),i=c;else{if(!c||"object"!=typeof c||!Array.isArray(c.words))return t("error","at services/word.js:334","更新单词失败：未识别的存储数据格式"),void r(new Error("未识别的存储数据格式"));t("log","at services/word.js:330","检测到新格式存储数据（对象包含words数组）"),i=c.words,u=!0}const p="string"==typeof e?parseInt(e,10):e;t("log","at services/word.js:341",`处理的ID为: ${p}，类型: ${typeof p}`);const v=i.findIndex((e=>e.id===p));if(-1===v)return t("error","at services/word.js:346",`更新单词失败：找不到ID为${e}的单词`),void r(new Error(`找不到ID为${e}的单词`));t("log","at services/word.js:351",`找到ID为${p}的单词，索引位置: ${v}`);const g=i[v].id,m=i[v].name;let w;a.id=g,a.examples||(a.examples=[]),a.relatedWords||(a.relatedWords=[]),a.notes||(a.notes=[]),t("log","at services/word.js:363",`更新单词: ${m} -> ${a.name}`),i[v]=a,u?(c.words=i,w=c):w=i,uni.setStorageSync(o,JSON.stringify(w)),t("log","at services/word.js:378","已将更新后的单词保存到本地存储"),void 0!==uni.$wordIdCache&&(t("log","at services/word.js:383",`清除ID为${p}的单词缓存`),uni.$wordIdCache&&uni.$wordIdCache[p]&&delete uni.$wordIdCache[p],t("log","at services/word.js:388","为安全起见，清空整个wordIdCache"),uni.$wordIdCache={}),void 0!==uni.$wordPreloadCache&&(t("log","at services/word.js:394","清除全局单词预加载缓存"),uni.$wordPreloadCache={});try{t("log","at services/word.js:400","尝试清除页面缓存"),uni.navigateBack({delta:0,success:()=>{t("log","at services/word.js:404","成功重新加载当前页面")},fail:e=>{t("log","at services/word.js:407","页面重新加载失败，可能在非导航上下文中:",e)}})}catch(s){t("log","at services/word.js:411","清除页面缓存失败，这是正常的，如果不在导航上下文中",s)}try{t("log","at services/word.js:416","发出单词更新事件通知"),uni.$emit("word-updated",{id:p,word:a}),uni.$emit("words-count-updated"),uni.$emit("global-data-updated")}catch(l){t("error","at services/word.js:421","发出单词更新事件时出错:",l)}n(a)}catch(i){t("error","at services/word.js:426","解析数据失败:",i),r(new Error("单词数据解析失败"))}}catch(d){t("error","at services/word.js:430","更新单词时出错:",d,d.stack),r(d)}}))),c=()=>Date.now().toString(36)+Math.random().toString(36).substr(2,5),u=(e,o="YYYY-MM-DD HH:mm:ss")=>{if(!e)return"";try{const t=new Date(e);if(isNaN(t.getTime()))return"";const a=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getDate().toString().padStart(2,"0"),s=t.getHours().toString().padStart(2,"0"),l=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0");return o.replace("YYYY",a).replace("MM",n).replace("DD",r).replace("HH",s).replace("mm",l).replace("ss",i)}catch(a){return t("error","at utils/common.js:41","日期格式化错误:",a),""}},p="reciter_errorbook",v=()=>new Promise((e=>{try{const a=uni.getStorageSync(p);if(!a)return t("log","at services/errorbook.js:24","本地存储中没有错误记录数据，返回空数组"),void e([]);try{const o=JSON.parse(a);if(Array.isArray(o)){t("log","at services/errorbook.js:34","读取到错误记录数据，长度:",o.length);const a=o.map((e=>({id:e.id,content:e.content||e.title||"",translation:e.translation||e.desc||"",word:e.word||"",note:e.note||"",createTime:e.createTime||e.date||(new Date).toISOString(),updateTime:e.updateTime||null})));return t("log","at services/errorbook.js:54","数据格式标准化完成，返回错误记录"),void e(a)}t("warn","at services/errorbook.js:60","存储的错误记录数据格式无法识别，返回空数组"),e([])}catch(o){t("error","at services/errorbook.js:63","解析错误记录数据失败:",o),e([])}}catch(a){t("error","at services/errorbook.js:67","获取错误记录列表失败:",a),e([])}})),g=()=>{try{const o=uni.getStorageSync(p);if(!o)return t("log","at services/errorbook.js:84","同步方法：本地存储中没有错误记录数据，返回空数组"),[];try{const e=JSON.parse(o);if(Array.isArray(e)){t("log","at services/errorbook.js:93","同步方法读取到错误记录数据，长度:",e.length);return e.map((e=>({id:e.id,content:e.content||e.title||"",translation:e.translation||e.desc||"",word:e.word||"",note:e.note||"",createTime:e.createTime||e.date||(new Date).toISOString(),updateTime:e.updateTime||null})))}return t("warn","at services/errorbook.js:117","同步方法：存储的错误记录数据格式无法识别，返回空数组"),[]}catch(e){return t("error","at services/errorbook.js:120","解析错误记录数据失败:",e),[]}}catch(o){return t("error","at services/errorbook.js:124","获取错误记录列表失败:",o),[]}},m=e=>{try{const o=getCurrentPages(),a=o[o.length-1];if(a){const t=a.onLoad;a.onLoad=function(o){"function"==typeof t&&t.call(this,o),e(o)}}else t("warn","at utils/uni-hooks.js:23","onLoad: 无法获取当前页面实例"),setTimeout((()=>{t("log","at utils/uni-hooks.js:27","onLoad: 使用setTimeout模拟"),e({})}),100)}catch(o){t("error","at utils/uni-hooks.js:32","onLoad适配器错误:",o)}},w=e=>{try{const o=getCurrentPages(),a=o[o.length-1];if(a){const t=a.onShow;a.onShow=function(){"function"==typeof t&&t.call(this),e()}}else t("warn","at utils/uni-hooks.js:52","onShow: 无法获取当前页面实例")}catch(o){t("error","at utils/uni-hooks.js:55","onShow适配器错误:",o)}},h=e=>{try{const o=getCurrentPages(),a=o[o.length-1];if(a){const t=a.onHide;a.onHide=function(){"function"==typeof t&&t.call(this),e()}}else t("warn","at utils/uni-hooks.js:75","onHide: 无法获取当前页面实例")}catch(o){t("error","at utils/uni-hooks.js:78","onHide适配器错误:",o)}},x=e=>{try{const o=getCurrentPages(),a=o[o.length-1];if(a){const t=a.onUnload;a.onUnload=function(){"function"==typeof t&&t.call(this),e()}}else t("warn","at utils/uni-hooks.js:98","onUnload: 无法获取当前页面实例")}catch(o){t("error","at utils/uni-hooks.js:101","onUnload适配器错误:",o)}},f={__name:"index",setup(o){const a=e.ref(0),n=e.ref(0),l=e.ref({width:375,height:667,pixelRatio:2,platform:"ios",orientation:"portrait"});e.computed((()=>{const{width:e,orientation:t}=l.value;return e<360?"device-small":e<768?"portrait"===t?"device-phone":"device-phone-landscape":e<1024?"device-tablet":"device-desktop"})),e.computed((()=>{const{width:e}=l.value;return e<360?"small":e<768?"medium":"large"})),e.computed((()=>{const{width:e,orientation:t}=l.value;return"landscape"===t?e<568?2:4:e<375?1:e<768?2:4}));const i=e=>{["/pages/index/index","/pages/wordlist/index","/pages/add/index","/pages/errorbook/index"].includes(e)?uni.switchTab({url:e}):uni.navigateTo({url:e})},d=async()=>{try{t("log","at pages/index/index.vue:153","加载单词列表数量..."),void 0!==uni.$wordPreloadCache&&(uni.$wordPreloadCache={});const e=await r(!0);Array.isArray(e)?(a.value=e.length,t("log","at pages/index/index.vue:164","获取到单词数量:",a.value)):(t("warn","at pages/index/index.vue:166","获取到的单词数据格式异常"),a.value=0)}catch(e){t("error","at pages/index/index.vue:170","获取单词数量失败:",e),a.value=0}},c=async()=>{try{t("log","at pages/index/index.vue:177","开始加载错题本数量");const e=await v();t("log","at pages/index/index.vue:179","获取到错题数据:",JSON.stringify(e)),Array.isArray(e)?(n.value=e.length,t("log","at pages/index/index.vue:183","设置错题数量为:",n.value)):(t("warn","at pages/index/index.vue:185","获取到的错题数据不是数组"),n.value=0)}catch(e){t("error","at pages/index/index.vue:189","获取错题数量失败:",e),n.value=0}},u=()=>{(()=>{try{const e=uni.getSystemInfoSync();t("log","at pages/index/index.vue:198","系统信息:",e);const o=e.windowWidth>e.windowHeight?"landscape":"portrait";l.value={width:e.windowWidth,height:e.windowHeight,pixelRatio:e.pixelRatio,platform:e.platform,orientation:o},t("log","at pages/index/index.vue:210","窗口尺寸:",l.value)}catch(e){t("error","at pages/index/index.vue:212","获取系统信息失败:",e)}})(),d(),c()};return e.onMounted((()=>{u(),uni.$on("errorbook-count-updated",(e=>{t("log","at pages/index/index.vue:271","接收到错题本计数更新事件:",e),e&&"number"==typeof e.count&&(n.value=e.count,t("log","at pages/index/index.vue:274","首页错题本计数已更新为:",n.value))})),uni.$on("words-count-updated",(e=>{if(t("log","at pages/index/index.vue:280","接收到单词数量更新事件:",e),e&&"number"==typeof e.count)a.value=e.count,t("log","at pages/index/index.vue:285","首页单词数量已直接更新为:",a.value);else{t("log","at pages/index/index.vue:288","事件没有提供count值，手动加载单词数量");try{const e=s();Array.isArray(e)&&(a.value=e.length,t("log","at pages/index/index.vue:294","手动加载的单词数量:",a.value))}catch(o){t("error","at pages/index/index.vue:297","手动加载单词数量失败:",o)}}}))})),w((()=>{d(),c()})),e.onBeforeUnmount((()=>{uni.$off("errorbook-count-updated"),uni.$off("words-count-updated")})),(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"feature-cards"},[e.createElementVNode("view",{class:"card-row"},[e.createElementVNode("view",{class:"card",onClick:o[0]||(o[0]=e=>i("/pages/wordlist/index"))},[e.createElementVNode("view",{class:"card-icon"},[e.createElementVNode("text",{class:"iconfont icon-list"},"📋")]),e.createElementVNode("view",{class:"card-title"},"单词列表"),e.createElementVNode("view",{class:"card-desc"},"共有单词："+e.toDisplayString(a.value)+"个",1)]),e.createElementVNode("view",{class:"card",onClick:o[1]||(o[1]=e=>i("/pages/errorbook/index"))},[e.createElementVNode("view",{class:"card-icon"},[e.createElementVNode("text",{class:"iconfont icon-book"},"📚")]),e.createElementVNode("view",{class:"card-title"},"错题本"),e.createElementVNode("view",{class:"card-desc"},"记录知识点："+e.toDisplayString(n.value)+"个",1)])]),e.createElementVNode("view",{class:"card-row"},[e.createElementVNode("view",{class:"card",onClick:o[2]||(o[2]=e=>i("/pages/add/index"))},[e.createElementVNode("view",{class:"card-icon"},[e.createElementVNode("text",{class:"iconfont icon-add"},"➕")]),e.createElementVNode("view",{class:"card-title"},"添加单词"),e.createElementVNode("view",{class:"card-desc"},"自定义添加新单词")]),e.createElementVNode("view",{class:"card",onClick:o[3]||(o[3]=e=>i("/pages/settings/index"))},[e.createElementVNode("view",{class:"card-icon"},[e.createElementVNode("text",{class:"iconfont icon-settings"},"⚙️")]),e.createElementVNode("view",{class:"card-title"},"设置"),e.createElementVNode("view",{class:"card-desc"},"自定义应用设置")])])])]))}},y="/static/images/empty.png",k=(e,t)=>{const o=e.__vccOpts||e;for(const[a,n]of t)o[a]=n;return o},E=k({__name:"LoadingError",props:{show:{type:Boolean,default:!1},message:{type:String,default:"数据加载失败"}},emits:["retry","dismiss"],setup(o,{emit:a}){const n=o,r=a,s=e.ref(0),l=e.ref(null);e.watch((()=>n.show),(e=>{e?(t("log","at components/LoadingError.vue:36","错误显示，将在3秒后自动重试"),i()):(d(),s.value=0)}));const i=()=>{d(),s.value<2&&(l.value=setTimeout((()=>{c()}),3e3))},d=()=>{l.value&&(clearTimeout(l.value),l.value=null)},c=e=>{t("log","at components/LoadingError.vue:61","执行重试操作，重试次数:",s.value+1),s.value++,e&&e.stopPropagation(),r("retry"),s.value<2&&i()},u=e=>{t("log","at components/LoadingError.vue:79","用户选择继续使用应用，忽略错误"),d(),e&&e.stopPropagation(),r("dismiss")};return e.onMounted((()=>{n.show&&i()})),(t,a)=>o.show?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-container",onClick:c},[e.createElementVNode("view",{class:"error-icon"},[e.createElementVNode("text",{class:"iconfont icon-warning"})]),e.createElementVNode("view",{class:"error-text"},e.toDisplayString(o.message),1),e.createElementVNode("view",{class:"error-retry"},"点击屏幕重试"),e.createElementVNode("view",{class:"error-continue",onClick:e.withModifiers(u,["stop"])},"继续使用应用")])):e.createCommentVNode("",!0)}},[["__scopeId","data-v-71f6a818"]]),N={__name:"index",setup(o){const a=e.ref([]),n=e.ref(!1),s=e.ref(!1),l=e.ref("数据加载失败"),i=e.ref("normal"),d=e.ref(""),c=e.ref(null),u=e.computed((()=>{if(!d.value)return a.value;const e=d.value.toLowerCase();return e.trim()?a.value.filter((t=>t.name.toLowerCase().includes(e)||t.meaning.includes(e))):a.value})),p=e.computed((()=>{if(x===v()&&g)return g;const e={};u.value.forEach((t=>{const o=t.name.charAt(0).toUpperCase();e[o]||(e[o]=[]),e[o].push(t)}));const t=Object.keys(e).sort().reduce(((t,o)=>(t[o]=e[o],t)),{});return g=t,x=v(),t})),v=()=>`${u.value.length}_${d.value}`;let g=null,x="";const f=e.computed((()=>{const e=Object.keys(p.value);return e.length>0?e:["A"]})),k=e.ref(""),N=e.ref(""),V=e.ref(!1);let b=null,C=null;const S=e=>{C||(C=setTimeout((()=>{C=null}),100))},T=e=>{const t=e.detail.value;c.value&&clearTimeout(c.value),c.value=setTimeout((()=>{d.value=t,x="",g=null,c.value=null}),300)},B=()=>{d.value=""},D=e=>{const o="string"==typeof e?parseInt(e,10):e;if(isNaN(o))return t("error","at pages/wordlist/index.vue:327","跳转失败: 无效ID"),void uni.showToast({title:"无法加载单词详情",icon:"none"});const a=`/pages/worddetail/index?id=${o}`;t("log","at pages/wordlist/index.vue:337","跳转URL:",a);try{uni.navigateTo({url:a,success:()=>{t("log","at pages/wordlist/index.vue:343","成功跳转到单词详情页, ID:",o)},fail:e=>{t("error","at pages/wordlist/index.vue:346","跳转失败:",e),uni.showToast({title:"页面跳转失败",icon:"none"}),setTimeout((()=>{t("log","at pages/wordlist/index.vue:354","尝试使用redirectTo方式跳转"),uni.redirectTo({url:a,success:()=>t("log","at pages/wordlist/index.vue:357","redirectTo成功"),fail:e=>t("error","at pages/wordlist/index.vue:358","redirectTo也失败:",e)})}),500)}})}catch(n){t("error","at pages/wordlist/index.vue:364","跳转异常:",n),uni.showToast({title:"跳转出错",icon:"none"})}},A=()=>{if(n.value)t("log","at pages/wordlist/index.vue:375","加载操作正在进行中，跳过重复加载");else try{n.value=!0,0===a.value.length&&uni.showLoading({title:"加载中...",mask:!0}),g=null,x="",$(),r(!0).then((e=>{a.value=e,x="",g=null,e.length>0?t("log","at pages/wordlist/index.vue:408","成功加载单词数据，数量:",e.length):t("log","at pages/wordlist/index.vue:410","单词列表为空"),uni.hideLoading(),n.value=!1})).catch((e=>{t("error","at pages/wordlist/index.vue:416","获取单词列表出错:",e),uni.hideLoading(),n.value=!1}))}catch(e){t("error","at pages/wordlist/index.vue:422","加载单词列表数据错误:",e),uni.hideLoading(),n.value=!1}},I=()=>{t("log","at pages/wordlist/index.vue:430","用户点击重试"),s.value=!1,A()},j=()=>{t("log","at pages/wordlist/index.vue:437","用户选择继续使用应用"),s.value=!1};w((()=>{t("log","at pages/wordlist/index.vue:443","单词列表页面显示"),A()})),m((e=>{e&&"select"===e.mode&&(i.value="select"),setTimeout((()=>{n.value||0!==a.value.length||r().then((e=>{Array.isArray(e)&&e.length>0?(a.value=e,t("log","at pages/wordlist/index.vue:462","预加载完成，数据数量:",e.length)):t("log","at pages/wordlist/index.vue:464","预加载完成，数据为空，保持空列表状态")})).catch((e=>{t("error","at pages/wordlist/index.vue:467","预加载出错:",e)}))}),50),setTimeout((()=>{A()}),300)}));const $=()=>{void 0!==uni.$wordPreloadCache&&(t("log","at pages/wordlist/index.vue:481","清理全局单词预加载缓存"),uni.$wordPreloadCache={})};return e.onUnmounted((()=>{t("log","at pages/wordlist/index.vue:488","单词列表页面卸载"),"undefined"!=typeof window&&window.removeEventListener("error",errorHandler,!0),uni.$off("refreshWordList"),b&&clearTimeout(b),C&&clearTimeout(C),c.value&&clearTimeout(c.value),g=null,$()})),h((()=>{t("log","at pages/wordlist/index.vue:511","单词列表页面隐藏"),$()})),e.onMounted((()=>{if(t("log","at pages/wordlist/index.vue:516","单词列表页面已挂载"),uni.$on("refreshWordList",(e=>{t("log","at pages/wordlist/index.vue:520","接收到刷新单词列表事件:",e),a.value=[],A()})),"undefined"!=typeof window){const o=e=>(t("error","at pages/wordlist/index.vue:529","捕获到页面错误:",e.message),e.preventDefault(),s.value||(uni.showToast({title:"发生了一些问题，正在恢复...",icon:"none",duration:2e3}),0===a.value.length&&e.message&&!e.message.includes("forceEmpty")&&t("log","at pages/wordlist/index.vue:543","尝试恢复基本功能，但不自动填充默认单词")),!0);window.addEventListener("error",o,!0),e.onUnmounted((()=>{"undefined"!=typeof window&&window.removeEventListener("error",o,!0),uni.$off("refreshWordList"),b&&clearTimeout(b),C&&clearTimeout(C),c.value&&clearTimeout(c.value),g=null}))}0!==a.value.length||n.value||A()})),(o,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},["select"===i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"select-tip"}," 点击单词进行选择 ")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content-container"},[e.createElementVNode("view",{class:"search-bar"},[e.createElementVNode("view",{class:"search-box"},[e.createElementVNode("text",{class:"iconfont icon-search"}),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),placeholder:"搜索单词",onInput:T},null,544),[[e.vModelText,d.value]]),d.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"iconfont icon-close",onClick:B})):e.createCommentVNode("",!0)])]),e.createElementVNode("scroll-view",{class:"word-list","scroll-y":"","scroll-into-view":N.value,onScroll:S,"scroll-with-animation":!0,"enable-back-to-top":!0,"show-scrollbar":!0,"refresher-enabled":!1},[u.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,((o,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,id:"letter-"+a},[e.createElementVNode("view",{class:"letter-title"},e.toDisplayString(a),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o,((o,a)=>(e.openBlock(),e.createElementBlock("view",{key:o.id,class:"word-item",onClick:e=>(e=>{if("select"===i.value){const t={id:e.id,name:e.name,pos:e.pos},o=getCurrentPages(),a=o[o.length-2];return a&&"pages/add/index"===a.route&&a.$vm.formData.relatedWords.push(t),void uni.navigateBack()}t("log","at pages/wordlist/index.vue:294","点击单词:",e.name),t("log","at pages/wordlist/index.vue:297","准备跳转到单词详情页, ID:",e.id,"类型:",typeof e.id),void 0===uni.$wordPreloadCache&&(uni.$wordPreloadCache={}),uni.$wordPreloadCache[e.id]=e;const o=parseInt(e.id,10);if(t("log","at pages/wordlist/index.vue:307","转换后的ID:",o,"类型:",typeof o),isNaN(o))return t("error","at pages/wordlist/index.vue:311","无效ID，无法跳转"),void uni.showToast({title:"无效的单词ID",icon:"none"});D(o)})(o)},[e.createElementVNode("view",{class:"word-name"},e.toDisplayString(o.name),1),e.createElementVNode("view",{class:"word-meaning"},[e.createElementVNode("text",{class:"word-pos"},e.toDisplayString(o.pos),1),e.createTextVNode(" "+e.toDisplayString(o.meaning),1)])],8,["onClick"])))),128))],8,["id"])))),128))])):0!==u.value.length||d.value?0===u.value.length&&d.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"empty-result"},[e.createElementVNode("image",{src:y,mode:"aspectFit"}),e.createElementVNode("text",null,"没有找到匹配的单词"),e.createElementVNode("button",{class:"small-btn",onClick:B},"清除搜索")])):e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-result"},[e.createElementVNode("image",{src:y,mode:"aspectFit"}),e.createElementVNode("text",null,"单词列表为空"),e.createElementVNode("text",{class:"empty-tip"},"您已清空数据，单词列表为空")]))],40,["scroll-into-view"])]),e.createElementVNode("view",{class:"letter-index"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:e.normalizeClass(["letter-item",{active:k.value===t}]),onClick:e=>(e=>{b&&clearTimeout(b),C&&clearTimeout(C),k.value=e,N.value="letter-"+e,V.value=!0,b=setTimeout((()=>{V.value=!1}),800)})(t)},e.toDisplayString(t),11,["onClick"])))),128))]),V.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"letter-tip"},e.toDisplayString(k.value),1)):e.createCommentVNode("",!0),e.createVNode(E,{show:s.value,message:l.value,onRetry:I,onDismiss:j},null,8,["show","message"])]))}},V=k({__name:"index",setup(a){const n=e.ref(!1),r=e.ref(null),c=e.reactive({name:"",pos:[],meaning:"",examples:[],notes:[]}),u=()=>{c.name="",c.pos=[],c.meaning="",c.examples=[],c.notes=[],n.value=!1,r.value=null,setTimeout((()=>{t("log","at pages/add/index.vue:187","表单已完全重置")}),0)},p=e.computed((()=>c.pos.join("/"))),v=[{label:"adj.",text:"形容词",value:"adj."},{label:"adv.",text:"副词",value:"adv."},{label:"n.",text:"名词",value:"n."},{label:"v.",text:"动词",value:"v."},{label:"prep.",text:"介词",value:"prep."},{label:"conj.",text:"连词",value:"conj."},{label:"pron.",text:"代词",value:"pron."},{label:"num.",text:"数词",value:"num."},{label:"art.",text:"冠词",value:"art."}],g=()=>{const e=new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},h=()=>{c.examples.push({en:"",zh:""})},f=()=>{c.notes||(c.notes=[]),c.notes.push("")},y=async()=>{var e;if(c.name.trim())if(0!==c.pos.length)if(c.meaning.trim())try{uni.showLoading({title:"保存中..."});const a={name:c.name.trim(),pos:p.value,meaning:c.meaning.trim(),examples:c.examples.filter((e=>e.en.trim()||e.zh.trim())),notes:c.notes.filter((e=>e.trim()))};n.value&&r.value?(a.id=r.value,await d(r.value,a),uni.hideLoading(),uni.showToast({title:"修改成功",icon:"success"})):(await(e=a,new Promise((a=>{try{let t=s();const n={id:t.length>0?Math.max(...t.map((e=>e.id)))+1:1,...e},r=[...t,n];uni.setStorageSync(o,JSON.stringify(r)),i(r.length),a(r)}catch(n){t("error","at services/word.js:295","添加单词出错:",n),a([])}}))),uni.hideLoading(),uni.showToast({title:"添加成功",icon:"success"})),uni.$emit("refreshWordList"),u(),setTimeout((()=>{uni.switchTab({url:"/pages/wordlist/index"})}),1500)}catch(a){uni.hideLoading(),t("error","at pages/add/index.vue:326","保存单词失败:",a),uni.showToast({title:"保存失败，请重试",icon:"none"})}else uni.showToast({title:"请输入中文释义",icon:"none"});else uni.showToast({title:"请选择词性",icon:"none"});else uni.showToast({title:"请输入单词",icon:"none"})},k=()=>{try{const e=getApp();if(e&&e.globalData){const{editWordId:o,editMode:a}=e.globalData;if("edit"===a&&o)return t("log","at pages/add/index.vue:342","从全局变量获取编辑参数:",o,a),n.value=!0,r.value=o,e.globalData.editWordId=null,e.globalData.editMode=null,E(o),!0}return!1}catch(e){return t("error","at pages/add/index.vue:359","获取全局编辑参数失败:",e),!1}},E=async e=>{try{uni.showLoading({title:"加载中..."});const t=await l(e);t?(c.name=t.name||"",c.meaning=t.meaning||"","string"==typeof t.pos?c.pos=t.pos.split("/").filter(Boolean):Array.isArray(t.pos)?c.pos=[...t.pos]:c.pos=[],t.examples&&Array.isArray(t.examples)?c.examples=[...t.examples]:c.examples=[],t.notes&&Array.isArray(t.notes)?c.notes=[...t.notes]:c.notes=[],uni.hideLoading()):(uni.hideLoading(),uni.showToast({title:"单词不存在",icon:"none"}),setTimeout((()=>{uni.navigateBack()}),1500))}catch(o){uni.hideLoading(),t("error","at pages/add/index.vue:413","加载单词详情失败:",o),uni.showToast({title:"加载失败",icon:"none"})}};m((e=>{try{t("log","at pages/add/index.vue:424","页面加载参数:",e),void 0!==uni.$wordPreloadCache&&(t("log","at pages/add/index.vue:428","清理单词预加载缓存"),uni.$wordPreloadCache={}),u();try{const e=plus.webview.currentWebview();e&&(e.setStyle({cachemode:"noCache"}),t("log","at pages/add/index.vue:443","设置APP页面不缓存"))}catch(o){t("error","at pages/add/index.vue:447","设置页面不缓存失败:",o)}const a=(()=>{const e=getCurrentPages();if(e.length<=1)return"tabbar";const t=e[e.length-2];return t&&t.route?t.route.includes("wordlist")?"wordlist":t.route:"unknown"})();t("log","at pages/add/index.vue:471","导航来源:",a),"wordlist"!==a&&"tabbar"!==a||setTimeout((()=>{t("log","at pages/add/index.vue:477","执行特殊来源页面渲染修复"),V(),setTimeout(b,300),setTimeout(b,600)}),200);try{const e=getCurrentPages(),o=e[e.length-1];if(o&&"function"==typeof o.$getAppWebview){const e=o.$getAppWebview();e&&"function"==typeof e.setStyle&&(e.setStyle({disableScroll:!1,cachemode:"noCache"}),t("log","at pages/add/index.vue:500","成功设置页面不缓存"))}}catch(o){t("error","at pages/add/index.vue:504","设置页面不缓存失败:",o)}e.id&&"edit"===e.mode?(n.value=!0,r.value=Number(e.id),E(Number(e.id))):k(),setTimeout((()=>{N()}),300)}catch(a){t("error","at pages/add/index.vue:523","处理页面参数失败:",a)}}));const N=()=>{t("log","at pages/add/index.vue:529","检查表单渲染")},V=()=>{t("log","at pages/add/index.vue:568","执行页面强制刷新");const e={name:c.name,pos:[...c.pos],meaning:c.meaning,examples:JSON.parse(JSON.stringify(c.examples)),notes:c.notes?[...c.notes]:[]};u(),setTimeout((()=>{c.name=e.name,c.pos=e.pos,c.meaning=e.meaning,c.examples=e.examples,c.notes=e.notes,t("log","at pages/add/index.vue:590","页面已刷新并恢复数据"),setTimeout((()=>{}),50)}),100)},b=()=>{};return w((()=>{t("log","at pages/add/index.vue:703","页面显示"),n.value||(u(),k()),setTimeout((()=>{N();const e=()=>{try{b()}catch(e){t("error","at pages/add/index.vue:734","重置文本框高度失败:",e)}};getCurrentPages().length<=1&&(t("log","at pages/add/index.vue:747","检测到可能是tabBar导航，执行特殊修复"),setTimeout(V,100)),e(),setTimeout(e,300),setTimeout(e,800)}),100)})),e.onMounted((()=>{t("log","at pages/add/index.vue:762","组件已挂载"),setTimeout((()=>{N()}),100)})),e.onUnmounted((()=>{t("log","at pages/add/index.vue:772","组件卸载，清理数据"),u()})),x((()=>{t("log","at pages/add/index.vue:779","页面卸载，清理数据"),u()})),(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"label-row"},[e.createElementVNode("text",{class:"required"},"*"),e.createElementVNode("text",{class:"label-text"},"单词")]),e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("input",{type:"text",class:"word-input","onUpdate:modelValue":o[0]||(o[0]=e=>c.name=e),placeholder:"输入单词"},null,512),[[e.vModelText,c.name]]),e.createElementVNode("text",{class:"time"},e.toDisplayString(g()),1)])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"label-row"},[e.createElementVNode("text",{class:"required"},"*"),e.createElementVNode("text",{class:"label-text"},"词性")]),e.createElementVNode("view",{class:"pos-selection"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(v,((t,o)=>e.createElementVNode("view",{key:o,class:e.normalizeClass(["pos-item",{active:c.pos.includes(t.value)}]),onClick:e=>(e=>{const t=c.pos.indexOf(e);-1===t?c.pos.push(e):c.pos.splice(t,1)})(t.value)},[e.createElementVNode("text",{class:"pos-abbr"},e.toDisplayString(t.label),1),e.createElementVNode("text",{class:"pos-text"},e.toDisplayString(t.text),1)],10,["onClick"]))),64))])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"label-row"},[e.createElementVNode("text",{class:"required"},"*"),e.createElementVNode("text",{class:"label-text"},"中文释义")]),e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("textarea",{id:"meaning-textarea",class:"form-textarea fixed-height","onUpdate:modelValue":o[1]||(o[1]=e=>c.meaning=e),placeholder:"输入中文释义","adjust-position":!1,"show-confirm-bar":!1,"disable-default-padding":!0,"cursor-spacing":10},null,512),[[e.vModelText,c.meaning]])])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"label-text"},"例句"),e.createElementVNode("view",{class:"add-button",onClick:h},[e.createElementVNode("text",{class:"add-icon"},"+"),e.createElementVNode("text",{class:"add-text"},"添加例句")])]),c.examples.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"items-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.examples,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"example-item"},[e.createElementVNode("view",{class:"input-container mb-2"},[e.withDirectives(e.createElementVNode("textarea",{class:"form-textarea fixed-height en-text","onUpdate:modelValue":e=>t.en=e,placeholder:"输入英文例句","adjust-position":!1,"show-confirm-bar":!1,"disable-default-padding":!0,"cursor-spacing":10},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.en]])]),e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("textarea",{class:"form-textarea fixed-height zh-text","onUpdate:modelValue":e=>t.zh=e,placeholder:"输入中文翻译","adjust-position":!1,"show-confirm-bar":!1,"disable-default-padding":!0,"cursor-spacing":10},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.zh]]),e.createElementVNode("view",{class:"delete-button",onClick:e=>(e=>{c.examples.splice(e,1)})(o)},[e.createElementVNode("text",{class:"delete-icon"},"×")],8,["onClick"])])])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("text",{class:"empty-text"},"添加例句有助于更好地理解单词用法")]))]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"label-text"},"注意事项"),e.createElementVNode("view",{class:"add-button",onClick:f},[e.createElementVNode("text",{class:"add-icon"},"+"),e.createElementVNode("text",{class:"add-text"},"添加注意事项")])]),c.notes&&c.notes.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"items-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.notes,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"note-item"},[e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("textarea",{class:"form-textarea fixed-height","onUpdate:modelValue":e=>c.notes[o]=e,placeholder:"输入注意事项","adjust-position":!1,"show-confirm-bar":!1,"disable-default-padding":!0,"cursor-spacing":10},null,8,["onUpdate:modelValue"]),[[e.vModelText,c.notes[o]]]),e.createElementVNode("view",{class:"delete-button",onClick:e=>(e=>{c.notes.splice(e,1)})(o)},[e.createElementVNode("text",{class:"delete-icon"},"×")],8,["onClick"])])])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("text",{class:"empty-text"},"添加注意事项，记录单词使用中的常见错误")]))]),e.createElementVNode("button",{class:"save-btn",onClick:y},e.toDisplayString(n.value?"保存修改":"保存单词"),1)]))}},[["__scopeId","data-v-2eaa0eab"]]),b=k({__name:"index",setup(o){let a=null,n=null;e.onMounted((()=>{r(),function(){if("android"===uni.getSystemInfoSync().platform){(function(e){return new Promise(((t,o)=>{if("android"===uni.getSystemInfoSync().platform){let a=[];if(e)return void t();a=["android.permission.READ_EXTERNAL_STORAGE","android.permission.WRITE_EXTERNAL_STORAGE"],a.length>0?plus.android.requestPermissions(a,(function(e){e.granted.length===a.length?t():o("权限未完全授予")}),(function(e){o(e)})):t()}else t()}))})(plus.android.importClass("android.os.Build").VERSION.SDK_INT>=29).then((()=>{t("log","at pages/settings/index.vue:89","权限已授予，初始化文件操作");const e=plus.android.runtimeMainActivity(),o=e.onActivityResult;e.onActivityResult=function(r,s,i){if(t("log","at pages/settings/index.vue:99",`onActivityResult: requestCode=${r}, resultCode=${s}`),1!==r&&2!==r&&3!==r)return"function"==typeof o?o(r,s,i):void 0;if(s===plus.android.importClass("android.app.Activity").RESULT_OK)try{switch(r){case 1:t("log","at pages/settings/index.vue:127","处理导入文件结果");try{const o=i.getData();if(!o)throw t("error","at pages/settings/index.vue:131","获取URI失败，URI为空"),new Error("获取URI失败");t("log","at pages/settings/index.vue:135","获取到导入文件URI:",o.toString());plus.android.importClass("android.content.ContentResolver");const a=e.getContentResolver().openInputStream(o);if(a){const e=plus.android.importClass("java.io.BufferedReader"),o=new e(new(plus.android.importClass("java.io.InputStreamReader"))(a,"UTF-8")),n=new(plus.android.importClass("java.lang.StringBuilder"));let r;try{for(;null!=(r=o.readLine());)n.append(r);const e=n.toString();t("log","at pages/settings/index.vue:157","文件内容读取成功，长度:",e.length),e.length>0?c(e):(t("error","at pages/settings/index.vue:162","读取的文件内容为空"),uni.showModal({title:"导入失败",content:"文件内容为空",showCancel:!1,confirmText:"确定"}))}finally{try{o&&o.close(),a&&a.close()}catch(d){t("error","at pages/settings/index.vue:176","关闭输入流错误:",d)}}}else t("error","at pages/settings/index.vue:181","无法打开输入流"),uni.showToast({title:"无法打开文件",icon:"none"}),tryReadDownloadDir()}catch(u){t("error","at pages/settings/index.vue:189","读取文件失败:",u),uni.showModal({title:"读取文件失败",content:u.message||"未知错误",showCancel:!1,confirmText:"确定"}),tryReadDownloadDir()}break;case 2:t("log","at pages/settings/index.vue:203","处理导出文件结果");try{if(a){const o=i.getData();t("log","at pages/settings/index.vue:207","获取到导出文件URI:",o.toString());plus.android.importClass("android.content.ContentResolver");const r=e.getContentResolver().openOutputStream(o);if(!r)throw t("error","at pages/settings/index.vue:255","无法打开输出流"),new Error("无法打开输出流");{const e=plus.android.importClass("java.io.OutputStreamWriter"),s=plus.android.importClass("java.io.BufferedWriter");let l=null;try{l=new s(new e(r,"UTF-8")),l.write(a),l.flush();let i="您选择的位置";try{i=o.getPath()}catch(p){t("error","at pages/settings/index.vue:230","获取路径错误:",p)}uni.showModal({title:"导出成功",content:`文件已保存到: ${i}`,showCancel:!1,confirmText:"确定"}),a=null,n=null}finally{try{l&&l.close(),r&&r.close()}catch(d){t("error","at pages/settings/index.vue:250","关闭输出流错误:",d)}}}}}catch(u){t("error","at pages/settings/index.vue:260","保存文件失败:",u),uni.showModal({title:"导出失败",content:"保存文件到您选择的位置失败: "+(u.message||"未知错误"),showCancel:!1,confirmText:"确定"}),a&&n&&(l(a,n),a=null,n=null)}break;case 3:t("log","at pages/settings/index.vue:279","处理目录选择结果");try{if(a&&n){const o=i.getData();t("log","at pages/settings/index.vue:283","获取到目录URI:",o.toString());const r=plus.android.importClass("android.provider.DocumentsContract"),s=(plus.android.importClass("android.content.ContentResolver"),r.createDocument(e.getContentResolver(),o,"application/json",n));if(!s)throw new Error("无法在所选目录创建文件");{const o=e.getContentResolver().openOutputStream(s);if(!o)throw new Error("无法打开输出流");{const e=plus.android.importClass("java.io.OutputStreamWriter"),r=plus.android.importClass("java.io.BufferedWriter");let l=null;try{l=new r(new e(o,"UTF-8")),l.write(a),l.flush();let i="您选择的目录";try{i=s.getPath()}catch(p){t("error","at pages/settings/index.vue:318","获取路径错误:",p)}uni.showModal({title:"导出成功",content:`文件已保存到: ${i}`,showCancel:!1,confirmText:"确定"}),a=null,n=null}finally{try{l&&l.close(),o&&o.close()}catch(d){t("error","at pages/settings/index.vue:338","关闭输出流错误:",d)}}}}}}catch(u){t("error","at pages/settings/index.vue:350","在选定目录创建文件失败:",u),uni.showModal({title:"导出失败",content:"在您选择的目录中创建文件失败: "+(u.message||"未知错误"),showCancel:!1,confirmText:"确定"}),a&&n&&(l(a,n),a=null,n=null)}}}catch(v){t("error","at pages/settings/index.vue:369","处理Activity结果时出错:",v)}else 2!==r&&3!==r||(t("log","at pages/settings/index.vue:113","用户取消了选择保存位置"),a&&n&&(l(a,n),a=null,n=null))}})).catch((e=>{t("error","at pages/settings/index.vue:374","权限请求失败:",e)}))}}()}));const r=()=>{try{const e=uni.getStorageSync("reciter_settings");if(e){JSON.parse(e)}}catch(e){t("error","at pages/settings/index.vue:437","加载设置失败:",e)}},s=()=>{try{a=null,n=null;const s=uni.getStorageSync("reciter_words")||"[]",d=uni.getStorageSync("reciter_settings")||"{}",c={words:JSON.parse(s),settings:JSON.parse(d),exportTime:(new Date).toISOString(),version:"1.0.0"},u=JSON.stringify(c),p=`reciter_backup_${(new Date).toISOString().replace(/[:.]/g,"_")}.json`;if("android"===uni.getSystemInfoSync().platform)try{a=u,n=p;plus.android.importClass("android.os.Build").VERSION.SDK_INT;const r=plus.android.importClass("android.content.Intent"),s=(plus.android.importClass("android.net.Uri"),plus.android.runtimeMainActivity()),i=new r(r.ACTION_CREATE_DOCUMENT);i.addCategory(r.CATEGORY_OPENABLE),i.setType("application/json"),i.putExtra(r.EXTRA_TITLE,p);try{s.startActivityForResult(i,2),t("log","at pages/settings/index.vue:517","启动文件保存对话框")}catch(e){t("error","at pages/settings/index.vue:519","启动文件选择器失败:",e);try{plus.android.importClass("android.provider.DocumentsContract");const e=new r(r.ACTION_OPEN_DOCUMENT_TREE);s.startActivityForResult(e,3),t("log","at pages/settings/index.vue:526","启动目录选择对话框")}catch(o){t("error","at pages/settings/index.vue:528","启动目录选择器失败:",o),l(u,p)}}}catch(r){t("error","at pages/settings/index.vue:535","导出操作失败:",r),l(u,p),a=null,n=null}else i(u,p)}catch(s){t("error","at pages/settings/index.vue:606","导出数据失败:",s),uni.showModal({title:"导出失败",content:s.message||"未知错误",showCancel:!1,confirmText:"确定"})}};function l(e,o){try{plus.android.importClass("android.content.Context");const r=plus.android.importClass("android.os.Environment"),s=plus.android.importClass("java.io.File"),l=plus.android.importClass("java.io.FileOutputStream"),d=r.getExternalStoragePublicDirectory(r.DIRECTORY_DOWNLOADS);if(t("log","at pages/settings/index.vue:627","下载目录路径:",d.getAbsolutePath()),!d.exists()){t("log","at pages/settings/index.vue:632","创建下载目录结果:",d.mkdirs())}const c=new s(d,o);t("log","at pages/settings/index.vue:637","要保存的文件路径:",c.getAbsolutePath());try{const o=new l(c),n=new(plus.android.importClass("java.io.OutputStreamWriter"))(o,"UTF-8"),r=new(plus.android.importClass("java.io.BufferedWriter"))(n);try{r.write(e),r.flush(),uni.showModal({title:"导出成功",content:`文件已保存至：\n${c.getAbsolutePath()}`,showCancel:!1,confirmText:"确定"})}finally{try{r&&r.close(),n&&n.close(),o&&o.close()}catch(a){t("error","at pages/settings/index.vue:665","关闭输出流错误:",a)}}}catch(n){t("error","at pages/settings/index.vue:670","写入文件失败:",n),uni.showModal({title:"导出失败",content:"写入文件失败: "+((null==n?void 0:n.message)||"未知错误"),showCancel:!1,confirmText:"确定"}),i(e,o)}}catch(r){t("error","at pages/settings/index.vue:681","Android文件保存失败:",r),i(e,o)}}function i(e,o){try{plus.io.requestFileSystem(plus.io.PRIVATE_DOC,(a=>{try{a.root.getFile(o,{create:!0,exclusive:!1},(a=>{try{a.createWriter((a=>{a.onwrite=()=>{let e=null;try{plus.android.importClass("android.content.Context");const t=plus.android.runtimeMainActivity().getExternalFilesDir(null);t&&(e=t.getAbsolutePath())}catch(a){t("error","at pages/settings/index.vue:707","获取应用文档目录失败:",a)}uni.showModal({title:"导出成功",content:e?`文件已保存到应用文档目录：\n${e}/${o}`:"文件已保存到应用文档目录",showCancel:!1,confirmText:"确定"})},a.onerror=e=>{t("error","at pages/settings/index.vue:721","写入文件错误:",e),uni.showModal({title:"导出失败",content:"保存文件失败: "+((null==e?void 0:e.message)||"未知错误"),showCancel:!1,confirmText:"确定"})};try{a.write(e)}catch(n){t("error","at pages/settings/index.vue:733","写入数据错误:",n),uni.showModal({title:"导出失败",content:"写入数据错误: "+((null==n?void 0:n.message)||"未知错误"),showCancel:!1,confirmText:"确定"})}}),(e=>{t("error","at pages/settings/index.vue:742","创建写入器错误:",e),uni.showModal({title:"导出失败",content:"创建写入器错误",showCancel:!1,confirmText:"确定"})}))}catch(n){t("error","at pages/settings/index.vue:751","文件Entry操作错误:",n),uni.showModal({title:"导出失败",content:"文件操作错误",showCancel:!1,confirmText:"确定"})}}),(e=>{t("error","at pages/settings/index.vue:760","获取文件错误:",e),uni.showModal({title:"导出失败",content:"获取文件错误",showCancel:!1,confirmText:"确定"})}))}catch(n){t("error","at pages/settings/index.vue:769","文件系统操作错误:",n),uni.showModal({title:"导出失败",content:"文件系统操作错误",showCancel:!1,confirmText:"确定"})}}),(e=>{t("error","at pages/settings/index.vue:778","请求文件系统错误:",e),uni.showModal({title:"导出失败",content:"请求文件系统错误",showCancel:!1,confirmText:"确定"})}))}catch(a){t("error","at pages/settings/index.vue:787","保存到私有目录总体错误:",a),uni.showModal({title:"导出失败",content:"保存到私有目录错误: "+((null==a?void 0:a.message)||"未知错误"),showCancel:!1,confirmText:"确定"})}}const d=()=>{try{let o=function(){plus.android.importClass("android.content.Context");const e=plus.android.importClass("android.os.Environment"),t=(plus.android.importClass("java.io.File"),e.getExternalStoragePublicDirectory(e.DIRECTORY_DOWNLOADS));if(!t.exists())return!1;const o=t.listFiles();if(!o||0===o.length)return!1;for(let a=0;a<o.length;a++){const e=o[a].getName();if(e.startsWith("reciter_backup_")&&e.endsWith(".json"))return!0}return!1},a=function(){try{const a=plus.android.importClass("android.content.Intent"),r=(plus.android.importClass("android.net.Uri"),plus.android.runtimeMainActivity()),s=new a(a.ACTION_OPEN_DOCUMENT);s.setType("*/*");try{const e=plus.android.importClass("java.lang.String"),t=plus.android.newArray(e,2);t[0]="application/json",t[1]="text/plain",s.putExtra(a.EXTRA_MIME_TYPES,t)}catch(e){t("error","at pages/settings/index.vue:881","设置MIME类型失败:",e),s.setType("application/json")}s.addCategory(a.CATEGORY_OPENABLE);try{r.startActivityForResult(s,1),t("log","at pages/settings/index.vue:891","启动文件选择对话框")}catch(o){t("error","at pages/settings/index.vue:893","启动原生文件选择器失败:",o),n()}}catch(a){t("error","at pages/settings/index.vue:898","创建文件选择器对象失败:",a),n()}},n=function(){try{plus.android.importClass("android.content.Context");const e=plus.android.importClass("android.os.Environment"),o=(plus.android.importClass("java.io.File"),e.getExternalStoragePublicDirectory(e.DIRECTORY_DOWNLOADS));if(t("log","at pages/settings/index.vue:912","下载目录路径:",o.getAbsolutePath()),!o.exists())throw t("log","at pages/settings/index.vue:916","下载目录不存在"),new Error("下载目录不存在");const n=o.listFiles();if(!n||0===n.length)throw t("log","at pages/settings/index.vue:923","下载目录为空"),new Error("下载目录为空");const s=[];for(let t=0;t<n.length;t++){const e=n[t],o=e.getName();o.startsWith("reciter_backup_")&&o.endsWith(".json")&&s.push({name:o,path:e.getAbsolutePath(),lastModified:e.lastModified()})}if(t("log","at pages/settings/index.vue:941","找到的备份文件:",JSON.stringify(s)),0===s.length)return t("log","at pages/settings/index.vue:944","没有找到备份文件"),void a();s.sort(((e,t)=>t.lastModified-e.lastModified));const l=s.map((e=>({text:e.name,value:e.path})));uni.showActionSheet({itemList:l.map((e=>e.text)),success:function(e){const o=l[e.tapIndex].value;t("log","at pages/settings/index.vue:962","用户选择的文件:",o),r(o)},fail:function(e){t("log","at pages/settings/index.vue:968","用户取消选择"),a()}})}catch(e){t("error","at pages/settings/index.vue:974","读取下载目录失败:",e),a()}},r=function(e){try{t("log","at pages/settings/index.vue:983","准备读取文件:",e);const a=new(plus.android.importClass("java.io.File"))(e);if(!a.exists())throw new Error("文件不存在");if(!a.canRead())throw new Error("无法读取文件，没有读取权限");const n=plus.android.importClass("java.io.FileInputStream"),r=plus.android.importClass("java.io.InputStreamReader"),s=plus.android.importClass("java.io.BufferedReader");let l=null,i=null,d=null;try{l=new n(a),i=new r(l,"UTF-8"),d=new s(i);const e=new(plus.android.importClass("java.lang.StringBuilder"));let o=null;for(;null!==(o=d.readLine());)e.append(o);const u=e.toString();if(t("log","at pages/settings/index.vue:1020","文件内容长度:",u.length),!(u.length>0))throw new Error("文件内容为空");c(u)}finally{try{d&&d.close(),i&&i.close(),l&&l.close()}catch(o){t("error","at pages/settings/index.vue:1034","关闭输入流错误:",o)}}}catch(a){t("error","at pages/settings/index.vue:1039","读取选择的文件失败:",a),uni.showModal({title:"读取文件失败",content:a.message||"未知错误",showCancel:!1,confirmText:"确定"})}};if("android"===uni.getSystemInfoSync().platform)try{o()?n():a()}catch(e){t("error","at pages/settings/index.vue:814","检查下载目录失败:",e),a()}else uni.showModal({title:"提示",content:"此功能仅支持Android平台",showCancel:!1,confirmText:"确定"})}catch(o){t("error","at pages/settings/index.vue:1058","导入数据总体失败:",o),uni.showModal({title:"导入失败",content:o.message||"未知错误",showCancel:!1,confirmText:"确定"})}},c=e=>{try{if(t("log","at pages/settings/index.vue:1072","导入数据长度:",e?e.length:0),!e||""===e.trim())throw new Error("导入数据为空");let n;try{n=JSON.parse(e)}catch(o){t("error","at pages/settings/index.vue:1083","JSON解析错误:",o,"尝试解析前100个字符:",e.substring(0,100)),t("log","at pages/settings/index.vue:1084","尝试移除BOM标记后再解析");const r=e.replace(/^\uFEFF/,"");try{n=JSON.parse(r)}catch(a){throw t("error","at pages/settings/index.vue:1091","第二次JSON解析失败:",a),new Error("导入的数据不是有效的JSON格式")}}if(!n.words||!Array.isArray(n.words))throw new Error("数据格式不正确：缺少words数组字段");uni.showModal({title:"确认导入",content:`发现${n.words.length}个单词数据，确定要导入吗？注意：导入将会覆盖已有的所有数据！`,confirmText:"确认导入",cancelText:"取消",success:e=>{e.confirm&&(uni.setStorageSync("reciter_words",JSON.stringify(n.words)),n.settings&&(uni.setStorageSync("reciter_settings",JSON.stringify(n.settings)),r()),uni.showToast({title:"数据导入成功",icon:"success",duration:2e3}),uni.$emit("words-count-updated",{count:n.words.length}),uni.$emit("refreshWordList",{imported:!0}))}})}catch(n){t("error","at pages/settings/index.vue:1133","解析导入数据失败:",n),uni.showModal({title:"导入数据失败",content:n.message||"未知错误",showCancel:!1,confirmText:"确定"})}},u=()=>{uni.showModal({title:"清空所有数据",content:"此操作将永久删除所有单词数据，且无法恢复，确定要继续吗？",confirmText:"确认清空",confirmColor:"#ff4d4f",cancelText:"取消",success:e=>{e.confirm&&p()}})},p=()=>{try{uni.setStorageSync("reciter_words",JSON.stringify([])),uni.showToast({title:"所有数据已清空",icon:"success",duration:2e3});const e={};uni.setStorageSync("reciter_settings",JSON.stringify(e)),r(),uni.$emit("words-count-updated",{count:0}),setTimeout((()=>{uni.switchTab({url:"/pages/wordlist/index",success:()=>{uni.$emit("refreshWordList",{cleared:!0})}})}),1e3)}catch(e){t("error","at pages/settings/index.vue:1196","清空数据失败:",e),uni.showToast({title:"清空数据失败",icon:"none"})}};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"settings-group"},[e.createElementVNode("view",{class:"group-title"},"数据设置"),e.createElementVNode("view",{class:"setting-item",onClick:s},[e.createElementVNode("view",{class:"setting-label"},[e.createElementVNode("text",{class:"label-text"},"数据导出"),e.createElementVNode("text",{class:"setting-sublabel"},"导出所有单词数据")]),e.createElementVNode("view",{class:"setting-control"},[e.createElementVNode("button",{class:"action-btn export-btn",onClick:e.withModifiers(s,["stop"])},"导出")])]),e.createElementVNode("view",{class:"setting-item",onClick:d},[e.createElementVNode("view",{class:"setting-label"},[e.createElementVNode("text",{class:"label-text"},"数据导入"),e.createElementVNode("text",{class:"setting-sublabel"},"导入备份的单词数据")]),e.createElementVNode("view",{class:"setting-control"},[e.createElementVNode("button",{class:"action-btn import-btn",onClick:e.withModifiers(d,["stop"])},"导入")])]),e.createElementVNode("view",{class:"setting-item",onClick:u},[e.createElementVNode("view",{class:"setting-label"},[e.createElementVNode("text",{class:"label-text danger-text"},"清空所有数据"),e.createElementVNode("text",{class:"setting-sublabel"},"删除所有单词数据")]),e.createElementVNode("view",{class:"setting-control"},[e.createElementVNode("button",{class:"action-btn danger-btn",onClick:e.withModifiers(u,["stop"])},"清空")])])]),e.createElementVNode("view",{class:"settings-group"},[e.createElementVNode("view",{class:"group-title"},"关于应用"),e.createElementVNode("view",{class:"setting-item"},[e.createElementVNode("view",{class:"setting-label"},[e.createElementVNode("text",{class:"label-text"},"版本")]),e.createElementVNode("view",{class:"setting-value"},[e.createElementVNode("text",null,"1.0.0")])]),e.createElementVNode("view",{class:"setting-item"},[e.createElementVNode("view",{class:"setting-label"},[e.createElementVNode("text",{class:"label-text"},"开发者")]),e.createElementVNode("view",{class:"setting-value"},[e.createElementVNode("text",null,"Reciter Team")])])])]))}},[["__scopeId","data-v-311a03c5"]]),C="reciter_words",S={__name:"index",setup(a){const n=[{id:1,name:"apple",pos:"n.",meaning:"苹果",englishMeaning:"a round fruit with red, yellow or green skin and firm white flesh",phonetic:"/ˈæpl/",examples:[{en:"She took a bite of the apple.",zh:"她咬了一口苹果。"},{en:"An apple a day keeps the doctor away.",zh:"一天一苹果，医生远离我。"}],notes:['apple除表示"苹果"外，也可用于短语"apple of one\'s eye"表示"心肝宝贝"','用于成语"the apple doesn\'t fall far from the tree"表示"有其父必有其子"'],relatedWords:[{id:42,name:"applesauce",pos:"n.",meaning:"苹果酱"},{id:43,name:"applet",pos:"n.",meaning:"小应用程序"},{id:44,name:"pineapple",pos:"n.",meaning:"菠萝，凤梨"}]},{id:2,name:"banana",pos:"n.",meaning:"香蕉",englishMeaning:"a long curved fruit with a yellow skin",phonetic:"/bəˈnɑːnə/",examples:[{en:"I like to eat a banana for breakfast.",zh:"我喜欢早餐吃香蕉。"},{en:"The monkey peeled the banana before eating it.",zh:"猴子在吃香蕉前先剥了皮。"}],notes:["香蕉在热带地区广泛种植","成熟的香蕉会从绿色变为黄色"],relatedWords:[{id:45,name:"plantain",pos:"n.",meaning:"芭蕉"},{id:46,name:"fruit",pos:"n.",meaning:"水果"}]},{id:3,name:"book",pos:"n./v.",meaning:"书；预订",englishMeaning:"a written or printed work consisting of pages; to reserve something",phonetic:"/bʊk/",examples:[{en:"I read a book about ancient history.",zh:"我读了一本关于古代历史的书。"},{en:"Please book a table for dinner tonight.",zh:"请为今晚的晚餐预订一张桌子。"},{en:"She likes to read books before going to sleep.",zh:"她喜欢睡前阅读书籍。"}],notes:['book作为名词表示"书籍"，作为动词表示"预订"',"常用短语：by the book（按规矩办事）、throw the book at（严惩）、in someone's book（在某人看来）"],relatedWords:[{id:47,name:"bookcase",pos:"n.",meaning:"书柜"},{id:48,name:"booklet",pos:"n.",meaning:"小册子"},{id:49,name:"booking",pos:"n.",meaning:"预订"},{id:50,name:"bookworm",pos:"n.",meaning:"书虫；爱读书的人"}]},{id:4,name:"pear",pos:"n.",meaning:"梨",englishMeaning:"a sweet fruit with a rounded bottom and slightly pointed top",phonetic:"/peər/",examples:[{en:"The pear was sweet and juicy.",zh:"这个梨又甜又多汁。"},{en:"Asian pears are more round than European pears.",zh:"亚洲梨比欧洲梨更圆。"}],notes:["梨有多种品种，形状和颜色各异","常见的表达：pear-shaped（梨形的；失败的）"],relatedWords:[{id:51,name:"fruit",pos:"n.",meaning:"水果"},{id:52,name:"apple",pos:"n.",meaning:"苹果"}]},{id:6,name:"eat",pos:"v.",meaning:"吃；进食",englishMeaning:"to put food in your mouth and swallow it",phonetic:"/iːt/",examples:[{en:"We usually eat dinner at 7 pm.",zh:"我们通常在晚上7点吃晚餐。"},{en:"The children ate all the cookies.",zh:"孩子们吃光了所有的饼干。"},{en:"I don't eat meat.",zh:"我不吃肉。"}],notes:["eat的过去式是ate，过去分词是eaten","常用搭配：eat up（吃完）、eat out（在外就餐）、eat away at（逐渐侵蚀）",'表达"吃饭"时，可以说eat a meal或have a meal'],relatedWords:[{id:53,name:"eatable",pos:"adj.",meaning:"可食用的"},{id:54,name:"edible",pos:"adj.",meaning:"可食用的"},{id:55,name:"feast",pos:"n./v.",meaning:"盛宴；尽情享用"},{id:56,name:"devour",pos:"v.",meaning:"狼吞虎咽；津津有味地读"}]}],r=e.ref({}),c=e.ref(null),u=e.ref(!0);e.ref(!1);const p=e.ref(!1),v=e.ref({show:!1,message:"数据加载失败",details:""}),g=e.ref(!1),h=e.reactive({name:"",pos:[],meaning:"",phonetic:"",examples:[],relatedWords:[],notes:[]}),x=[{label:"adj.",text:"形容词",value:"adj."},{label:"adv.",text:"副词",value:"adv."},{label:"n.",text:"名词",value:"n."},{label:"v.",text:"动词",value:"v."},{label:"prep.",text:"介词",value:"prep."},{label:"conj.",text:"连词",value:"conj."},{label:"pron.",text:"代词",value:"pron."},{label:"num.",text:"数词",value:"num."},{label:"art.",text:"冠词",value:"art."}];e.computed((()=>r.value&&r.value.phonetic?r.value.phonetic.replace(/^\/|\/$/g,""):""));const f=e.computed((()=>h.pos.join("/"))),y=(e,t)=>{if(!e||!t)return e;const o=new RegExp(`\\b(${t})\\b`,"gi");return e.replace(o,'<span class="highlight">$1</span>')},k={},E=()=>{t("log","at pages/worddetail/index.vue:552","启动紧急恢复流程");try{const o=uni.getStorageSync(C);if(o)try{const e=JSON.parse(o);if(e&&"object"==typeof e&&!0===e.forceEmpty)return t("log","at pages/worddetail/index.vue:561","紧急恢复检测到forceEmpty标志，显示清空状态信息"),v.value={show:!0,message:"单词数据已被清空",details:"请返回单词列表页面"},u.value=!1,!0}catch(e){t("error","at pages/worddetail/index.vue:573","检查forceEmpty标志失败:",e)}if(n&&n.length>0){const e=n[0];return t("log","at pages/worddetail/index.vue:580","使用第一个模拟单词作为紧急恢复:",e.name),r.value=e,u.value=!1,v.value.show=!1,uni.showToast({title:"加载了默认单词",icon:"none",duration:2e3}),!0}return!1}catch(e){return t("error","at pages/worddetail/index.vue:597","紧急恢复也失败了:",e),!1}},N=async(e=0,o=3)=>{if(!c.value)return t("error","at pages/worddetail/index.vue:696","加载失败：wordId 为空或无效"),v.value={show:!0,message:"无效的单词ID，请返回后重试",details:"参数错误"},E()?void t("log","at pages/worddetail/index.vue:705","紧急恢复成功，显示默认单词"):void(u.value=!1);try{const e=uni.getStorageSync(C);if(e){const o=JSON.parse(e);if(o&&"object"==typeof o&&!0===o.forceEmpty)return t("log","at pages/worddetail/index.vue:719","loadWordDetail检测到forceEmpty标志，不加载单词并返回错误"),u.value=!1,void(v.value={show:!0,message:"单词数据已被清空",details:"请返回单词列表页面"})}}catch(a){t("error","at pages/worddetail/index.vue:731","检查forceEmpty标志失败:",a)}if(t("log","at pages/worddetail/index.vue:734",`开始加载单词详情，ID:${c.value}，尝试次数:${e+1}/${o+1}`),u.value=!0,v.value.show=!1,uni.$wordPreloadCache&&uni.$wordPreloadCache[c.value]){t("log","at pages/worddetail/index.vue:740","从全局预加载缓存获取单词数据:",uni.$wordPreloadCache[c.value].name);const e=uni.$wordPreloadCache[c.value];return e.examples||(e.examples=[]),e.relatedWords||(e.relatedWords=[]),e.notes||(e.notes=[]),r.value=e,k[c.value]=e,u.value=!1,void setTimeout((()=>{b(c.value)}),100)}if(k[c.value]){const e=uni.getStorageSync(C);if(e)try{const o=JSON.parse(e),a=Array.isArray(o)?o:o&&Array.isArray(o.words)?o.words:null;if(a){if(a.some((e=>e.id===c.value)))return t("log","at pages/worddetail/index.vue:784","从缓存加载单词详情:",k[c.value].name),r.value=k[c.value],void(u.value=!1);t("log","at pages/worddetail/index.vue:780",`单词ID ${c.value} 不再存在于本地存储中，清除缓存`),delete k[c.value]}}catch(a){t("error","at pages/worddetail/index.vue:791","检查单词是否存在失败:",a),delete k[c.value]}else t("log","at pages/worddetail/index.vue:797","本地存储为空，清除所有缓存"),Object.keys(k).forEach((e=>delete k[e]))}try{t("log","at pages/worddetail/index.vue:803","从存储中加载单词...");const e=await Promise.race([V(c.value),new Promise(((e,t)=>setTimeout((()=>t(new Error("加载超时"))),3e3)))]);if(t("log","at pages/worddetail/index.vue:810","从存储中加载结果:",e?e.name:"无结果"),!e)throw t("error","at pages/worddetail/index.vue:813","加载结果为空"),new Error("找不到单词详情");r.value=e,k[c.value]=e,u.value=!1,setTimeout((()=>{b(c.value)}),100),t("log","at pages/worddetail/index.vue:828","单词详情加载成功:",e.name)}catch(a){if(t("error","at pages/worddetail/index.vue:831",`加载单词详情失败(ID:${c.value})，错误:`,a),u.value=!1,a.message&&a.message.includes("数据已被清空"))return void(v.value={show:!0,message:"单词数据已被清空",details:"请返回单词列表页面"});if(a.notFound){t("log","at pages/worddetail/index.vue:846",`ID为${c.value}的单词在本地存储中不存在，尝试从mockWords查找`);const e=n.find((e=>e.id===c.value));if(e)return t("log","at pages/worddetail/index.vue:851",`在mockWords中找到单词: ${e.name}，但本地存储中没有这个单词`),void(v.value={show:!0,message:`ID为${c.value}的单词在您的单词库中不存在`,details:`您可能尝试访问的是示例单词"${e.name}"，但它不在您的单词库中`})}if(v.value={show:!0,message:`加载失败: ${a.message||"未知错误"}`,details:a.stack},e>=o&&(t("log","at pages/worddetail/index.vue:871","已达到最大重试次数，尝试紧急恢复"),E()))return;if(a.message.includes("找不到单词")||a.message.includes("无效ID")){if(E())return;return uni.showToast({title:"找不到该单词",icon:"none"}),void setTimeout((()=>uni.navigateBack()),1500)}if(e>=o)return uni.showToast({title:"加载失败，将返回上一页",icon:"none",duration:2e3}),void setTimeout((()=>uni.navigateBack()),2e3);t("log","at pages/worddetail/index.vue:902",`准备进行第${e+2}次尝试...`),N(e+1,o)}},V=e=>new Promise(((o,a)=>{t("log","at pages/worddetail/index.vue:910",`尝试从本地存储加载ID为${e}的单词详情`);try{const r=uni.getStorageSync(C);if(t("log","at pages/worddetail/index.vue:915",`从本地存储加载单词数据，存储状态: ${!!r}`),!r)return t("error","at pages/worddetail/index.vue:918","本地存储中没有单词数据"),void a(new Error("本地存储中没有单词数据"));try{let n,s=JSON.parse(r);if(Array.isArray(s))t("log","at pages/worddetail/index.vue:929","检测到旧格式存储数据（数组）"),n=s;else{if(!s||"object"!=typeof s||!Array.isArray(s.words))return t("error","at pages/worddetail/index.vue:935","未识别的存储数据格式"),void a(new Error("单词数据格式错误"));t("log","at pages/worddetail/index.vue:932","检测到新格式存储数据（对象包含words数组）"),n=s.words}const l="string"==typeof e?parseInt(e,10):e;t("log","at pages/worddetail/index.vue:942",`查找ID为${l}的单词，ID类型: ${typeof l}`);const i=n.find((e=>e.id===l));if(i)t("log","at pages/worddetail/index.vue:948",`找到ID为${l}的单词: ${i.name}`),o(i);else{t("error","at pages/worddetail/index.vue:951",`未找到ID为${l}的单词`);const e=new Error(`找不到ID为${l}的单词`);e.notFound=!0,a(e)}}catch(n){t("error","at pages/worddetail/index.vue:957","解析单词数据失败:",n),a(new Error("解析单词数据失败: "+n.message))}}catch(r){t("error","at pages/worddetail/index.vue:961","加载单词详情时出错:",r,r.stack),a(r)}})),b=async e=>{try{const o=uni.getStorageSync(C);if(!o)return;const a=JSON.parse(o);if(a&&"object"==typeof a&&!0===a.forceEmpty)return void t("log","at pages/worddetail/index.vue:976","预加载发现forceEmpty标志，取消预加载操作");const n=Array.isArray(a)?a:a&&Array.isArray(a.words)?a.words:null;if(!Array.isArray(n))return;const r=n.findIndex((t=>t.id===e));if(-1===r)return;const s=[r-2,r-1,r+1,r+2].filter((e=>e>=0&&e<n.length));t("log","at pages/worddetail/index.vue:998","预加载相邻单词:",s.map((e=>n[e].name)).join(", ")),s.forEach((e=>{const t=n[e];t&&!k[t.id]&&(k[t.id]=t)}))}catch(o){t("error","at pages/worddetail/index.vue:1008","预加载相邻单词失败:",o)}},S=()=>{if(t("log","at pages/worddetail/index.vue:1036","用户点击重试加载"),v.value.show=!1,!c.value){if(t("error","at pages/worddetail/index.vue:1041","wordId无效，尝试使用默认ID"),!(n&&n.length>0))return uni.showToast({title:"无法加载默认单词",icon:"none"}),void setTimeout((()=>uni.navigateBack()),1500);c.value=n[0].id,t("log","at pages/worddetail/index.vue:1045","设置了默认ID:",c.value)}N(0,3)};function T(){t("log","at pages/worddetail/index.vue:1059","dismissError被调用"),v.value.show=!1,uni.navigateBack()}const B=e=>{const o=`/pages/worddetail/index?id=${e}`;t("log","at pages/worddetail/index.vue:1132",`跳转URL: ${o}`),p.value=!1,uni.navigateTo({url:o,success:()=>{t("log","at pages/worddetail/index.vue:1140",`成功跳转到单词ID: ${e}`)},fail:e=>{t("error","at pages/worddetail/index.vue:1143","跳转失败:",e),uni.showToast({title:"跳转失败",icon:"none"})}})},D=()=>{try{if(!r.value||!r.value.id)return void uni.showToast({title:"单词信息不完整，无法编辑",icon:"none"});g.value=!0,h.name=r.value.name||"",h.meaning=r.value.meaning||"",h.phonetic=r.value.phonetic||"","string"==typeof r.value.pos?h.pos=r.value.pos.split("/").filter(Boolean):Array.isArray(r.value.pos)?h.pos=[...r.value.pos]:h.pos=[],h.examples=Array.isArray(r.value.examples)?JSON.parse(JSON.stringify(r.value.examples)):[],h.relatedWords=Array.isArray(r.value.relatedWords)?JSON.parse(JSON.stringify(r.value.relatedWords)):[],h.notes=Array.isArray(r.value.notes)?JSON.parse(JSON.stringify(r.value.notes)):[],t("log","at pages/worddetail/index.vue:1193","进入编辑模式，表单数据:",h)}catch(e){t("error","at pages/worddetail/index.vue:1195","处理编辑操作失败:",e),uni.showToast({title:"操作失败，请重试",icon:"none"})}},A=async()=>{var e;try{if(!h.name||""===h.name.trim())return void uni.showToast({title:"请输入单词",icon:"none",duration:2e3});if(0===h.pos.length)return void uni.showToast({title:"请选择至少一个词性",icon:"none",duration:2e3});if(!h.meaning||""===h.meaning.trim())return void uni.showToast({title:"请输入中文释义",icon:"none",duration:2e3});uni.showLoading({title:"保存修改...",mask:!0});const a={id:r.value.id,name:h.name,pos:f.value,meaning:h.meaning,phonetic:h.phonetic||"",examples:h.examples||[],relatedWords:h.relatedWords||[],notes:h.notes||[]},n=(null==(e=r.value.relatedWords)?void 0:e.map((e=>e.id)))||[],s=h.relatedWords.map((e=>e.id)),i=s.filter((e=>!n.includes(e))),u=n.filter((e=>!s.includes(e)));if(await d(a.id,a),i.length>0||u.length>0)try{for(const e of i){const t=await l(e);if(t){t.relatedWords||(t.relatedWords=[]);t.relatedWords.some((e=>e.id===r.value.id))||(t.relatedWords.push({id:r.value.id,name:a.name,pos:a.pos,meaning:a.meaning}),await d(t.id,t))}}for(const e of u){const t=await l(e);t&&t.relatedWords&&(t.relatedWords=t.relatedWords.filter((e=>e.id!==r.value.id)),await d(t.id,t))}}catch(o){t("error","at pages/worddetail/index.vue:1307","更新相关单词关联关系失败:",o)}t("log","at pages/worddetail/index.vue:1313","清除单词ID缓存:",c.value),delete k[c.value],uni.$wordPreloadCache&&uni.$wordPreloadCache[c.value]&&(t("log","at pages/worddetail/index.vue:1318","清除全局预加载缓存"),delete uni.$wordPreloadCache[c.value]),t("log","at pages/worddetail/index.vue:1323","从存储中重新加载单词数据");const p=await l(c.value);p?(t("log","at pages/worddetail/index.vue:1328","成功从存储中加载最新数据:",p.name),r.value=p,k[c.value]=p):(t("log","at pages/worddetail/index.vue:1334","无法从存储中加载最新数据，使用保存的数据"),r.value={...a},k[c.value]={...a}),g.value=!1,uni.hideLoading(),uni.showToast({title:"修改成功",icon:"success",duration:1500}),t("log","at pages/worddetail/index.vue:1351","发送刷新单词列表事件"),uni.$emit("refreshWordList")}catch(o){uni.hideLoading(),t("error","at pages/worddetail/index.vue:1355","保存修改失败:",o),uni.showToast({title:"保存失败，请重试",icon:"none",duration:2e3})}},I=()=>{g.value=!1,h.name="",h.pos=[],h.meaning="",h.phonetic="",h.examples=[],h.relatedWords=[],h.notes=[],uni.showToast({title:"已取消编辑",icon:"none",duration:1500})},j=()=>{h.examples.push({en:"",zh:""})},$=()=>{h.notes.push("")},M=()=>{r.value&&r.value.id?uni.showModal({title:"确认删除",content:`确定要删除单词"${r.value.name}"吗？此操作不可恢复。`,confirmText:"删除",confirmColor:"#ff0000",cancelText:"取消",success:async e=>{var a,n;if(e.confirm)try{uni.showLoading({title:"删除中..."});const e=(null==(a=r.value.relatedWords)?void 0:a.map((e=>e.id)))||[],u=r.value.id;if(await(n=u,new Promise((e=>{try{t("log","at services/word.js:444",`准备删除ID为${n}的单词`);const r=s().filter((e=>e.id!==n));uni.setStorageSync(o,JSON.stringify(r)),void 0!==uni.$wordIdCache&&(t("log","at services/word.js:458",`清除ID为${n}的单词缓存`),uni.$wordIdCache&&uni.$wordIdCache[n]&&delete uni.$wordIdCache[n],t("log","at services/word.js:462","为安全起见，清空整个wordIdCache"),uni.$wordIdCache={}),void 0!==uni.$wordPreloadCache&&(t("log","at services/word.js:468","清除全局单词预加载缓存"),uni.$wordPreloadCache={}),i(r.length);try{t("log","at services/word.js:477","发出单词数据更新事件通知"),uni.$emit("global-data-updated")}catch(a){t("error","at services/word.js:480","发出事件时出错:",a)}e(r)}catch(r){t("error","at services/word.js:485","删除单词出错:",r),e([])}}))),void 0!==uni.$wordIdCache&&(t("log","at pages/worddetail/index.vue:1450",`清除ID为${u}的单词缓存`),uni.$wordIdCache&&uni.$wordIdCache[u]&&delete uni.$wordIdCache[u],t("log","at pages/worddetail/index.vue:1454","为安全起见，清空整个wordIdCache"),uni.$wordIdCache={}),void 0!==uni.$wordPreloadCache&&(t("log","at pages/worddetail/index.vue:1460","清除全局单词预加载缓存"),uni.$wordPreloadCache={}),e.length>0)try{for(const t of e){const e=await l(t);e&&e.relatedWords&&(e.relatedWords=e.relatedWords.filter((e=>e.id!==u)),await d(e.id,e))}}catch(c){t("error","at pages/worddetail/index.vue:1478","更新关联关系失败:",c)}t("log","at pages/worddetail/index.vue:1484","发送刷新单词列表事件"),uni.$emit("refreshWordList"),uni.hideLoading(),uni.showToast({title:"删除成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)}catch(u){t("error","at pages/worddetail/index.vue:1495","删除单词失败:",u),uni.hideLoading(),uni.showModal({title:"删除失败",content:"删除单词时出现错误，是否重试？",confirmText:"重试",success:e=>{e.confirm&&M()}})}}}):uni.showToast({title:"单词信息不完整，无法删除",icon:"none"})},L=()=>{t("log","at pages/worddetail/index.vue:1517","加载默认单词作为备用");const e=n[0];return!!e&&(t("log","at pages/worddetail/index.vue:1522","成功获取默认单词:",e.name),r.value=e,c.value=e.id,u.value=!1,setTimeout((()=>{uni.showToast({title:"已加载默认单词",icon:"none",duration:2e3})}),500),!0)},P=()=>{t("log","at pages/worddetail/index.vue:1544","强制初始化单词详情页"),!u.value&&r.value&&r.value.id?t("log","at pages/worddetail/index.vue:1548","页面已成功加载，无需初始化"):u.value&&(t("log","at pages/worddetail/index.vue:1554","页面仍在加载中，强制加载默认单词"),L())};function O(e){t("log","at pages/worddetail/index.vue:1722","开始处理ID参数:",e,"类型:",typeof e);try{const o=e;let a;if("number"==typeof o)a=o;else{if("string"!=typeof o)throw new Error("意外的ID类型: "+typeof o);if(!/^\d+$/.test(o))throw new Error(`无效的ID格式: ${o}`);a=parseInt(o,10)}if(isNaN(a))throw new Error("无效的ID格式 (NaN)");if(uni.$wordPreloadCache&&uni.$wordPreloadCache[a]){t("log","at pages/worddetail/index.vue:1748","从全局预加载缓存获取单词数据:",uni.$wordPreloadCache[a].name);const e=uni.$wordPreloadCache[a];return e.examples||(e.examples=[]),e.relatedWords||(e.relatedWords=[]),e.notes||(e.notes=[]),c.value=a,r.value=e,k[a]=e,u.value=!1,void setTimeout((()=>{b(a)}),100)}t("log","at pages/worddetail/index.vue:1774","成功解析ID，设置wordId为:",a),c.value=a,N(0,3)}catch(o){t("error","at pages/worddetail/index.vue:1780","处理ID参数错误:",o),E()?t("log","at pages/worddetail/index.vue:1784","参数处理错误，但紧急恢复成功"):(v.value={show:!0,message:"参数错误，无法加载单词",details:o.message},u.value=!1)}}function _(){t("log","at pages/worddetail/index.vue:1798","处理缺失ID情况"),t("log","at pages/worddetail/index.vue:1800","尝试使用默认ID 1 (apple)"),c.value=1,c.value?(t("log","at pages/worddetail/index.vue:1804","已设置默认ID:",c.value),N(0,3)):E()?t("log","at pages/worddetail/index.vue:1809","无有效参数，但紧急恢复成功"):(v.value={show:!0,message:"未提供单词ID",details:"参数缺失"},u.value=!1)}w((()=>{t("log","at pages/worddetail/index.vue:1589","单词详情页面显示，执行handlePageShow，当前ID:",c.value);const e=getCurrentPages(),o=e[e.length-1];o&&o.$refreshCount>0?c.value?(k[c.value]&&(t("log","at pages/worddetail/index.vue:1565","页面显示时清除缓存，确保加载最新数据:",c.value),delete k[c.value]),uni.$wordPreloadCache&&uni.$wordPreloadCache[c.value]&&(t("log","at pages/worddetail/index.vue:1571","页面显示时清除全局预加载缓存"),delete uni.$wordPreloadCache[c.value]),setTimeout((()=>{t("log","at pages/worddetail/index.vue:1577","页面显示，重新加载单词详情:",c.value),N(0,3)}),200)):(t("log","at pages/worddetail/index.vue:1582","handlePageShow: ID为空，尝试加载默认单词"),L()):o&&(o.$refreshCount=(o.$refreshCount||0)+1)})),e.onMounted((()=>{if(t("log","at pages/worddetail/index.vue:1605","单词详情页面已挂载，ID:",c.value),!c.value&&!p.value){t("log","at pages/worddetail/index.vue:1609","onMounted: ID为空，尝试使用默认ID");try{const e=getCurrentPages(),o=e[e.length-1];if(o&&o.$page&&o.$page.fullPath){t("log","at pages/worddetail/index.vue:1616","onMounted: 尝试从URL获取ID, 当前路径:",o.$page.fullPath);const e=/[?&]id=([^&]+)/.exec(o.$page.fullPath);if(e&&e[1]){const o=parseInt(e[1],10);return t("log","at pages/worddetail/index.vue:1622","onMounted: 从URL成功获取ID:",o),p.value=!0,c.value=o,t("log","at pages/worddetail/index.vue:1628","onMounted: 设置wordId为:",c.value),void N(0,3)}t("log","at pages/worddetail/index.vue:1634","onMounted: 无法从URL获取ID参数")}else t("log","at pages/worddetail/index.vue:1637","onMounted: 无法获取当前页面信息")}catch(e){t("error","at pages/worddetail/index.vue:1640","onMounted: 解析URL获取ID出错:",e)}setTimeout((()=>{c.value||p.value||(t("log","at pages/worddetail/index.vue:1646","onMounted: 经过延时后ID仍为空，设置默认ID"),c.value=1,u.value&&N(0,3))}),500)}setTimeout(P,5e3)})),m((e=>{t("log","at pages/worddetail/index.vue:1661","单词详情页面 onLoad 生命周期触发，参数:",e),r.value={name:"加载中..."},u.value=!0,v.value.show=!1;const o=getCurrentPages(),a=o[o.length-1];let n=null;a&&a.options&&(n=a.options);const s=e&&Object.keys(e).length>0?e:n;let l=!1;try{if(s&&void 0!==s.id&&null!==s.id&&""!==s.id)return t("log","at pages/worddetail/index.vue:1686","从options直接获取到ID:",s.id),l=!0,p.value=!0,void O(s.id);if(!l){const e=a?a.route+(a.$page&&a.$page.fullPath?a.$page.fullPath:""):"",o=/[?&]id=([^&]+)/.exec(e);if(o&&o[1])return t("log","at pages/worddetail/index.vue:1700","从URL成功解析到ID:",o[1]),l=!0,p.value=!0,void O(o[1])}l||(t("error","at pages/worddetail/index.vue:1711","没有找到有效的ID参数"),_())}catch(i){t("error","at pages/worddetail/index.vue:1715","onLoad处理总体错误:",i),_()}}));const W=async()=>{t("log","at pages/worddetail/index.vue:1823","单词刷新按钮被点击");try{const e=uni.getStorageSync(C);if(e){const o=JSON.parse(e);if(o&&"object"==typeof o&&!0===o.forceEmpty)return t("log","at pages/worddetail/index.vue:1831","handleRefresh检测到forceEmpty标志，无法刷新单词"),void uni.showToast({title:"数据已被清空，无法刷新",icon:"none",duration:2e3})}}catch(e){t("error","at pages/worddetail/index.vue:1841","检查forceEmpty标志失败:",e)}uni.showLoading({title:"刷新单词中...",mask:!0}),k[c.value]&&(t("log","at pages/worddetail/index.vue:1852",`清除ID为${c.value}的缓存`),delete k[c.value]),setTimeout((async()=>{uni.hideLoading();try{t("log","at pages/worddetail/index.vue:1862","重新从存储加载单词详情"),await N(0,3),uni.showToast({title:"刷新成功",icon:"success",duration:1500})}catch(e){t("error","at pages/worddetail/index.vue:1871","刷新后重新加载单词详情失败:",e),uni.showToast({title:"无法刷新单词",icon:"none",duration:1500})}}),1e3)},U=e.ref(""),R=e.ref([]),F=e.ref(!1),J=async e=>{var o;const a=(null==(o=null==e?void 0:e.detail)?void 0:o.value)||U.value;if(a)try{const e=await(e=>new Promise((o=>{try{let t=s();if(!e)return void o(t);const a=e.toLowerCase();o(t.filter((e=>e.name.toLowerCase().includes(a)||e.meaning.includes(a))))}catch(a){t("error","at services/word.js:517","搜索单词出错:",a),o([])}})))(a),o=e.filter((e=>{if(e.id===r.value.id)return!1;return!h.relatedWords.some((t=>t.id===e.id))}));R.value=o}catch(n){t("error","at pages/worddetail/index.vue:1911","搜索相关单词失败:",n),uni.showToast({title:"搜索失败",icon:"none"})}else R.value=[]},z=()=>{U.value="",R.value=[],F.value=!1},q=()=>{F.value=!0,U.value="",R.value=[]};return(o,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:e.normalizeClass(["word-header",{loading:u.value}])},[e.createElementVNode("view",{class:"word-main"},[g.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:1,class:"word-name-input","onUpdate:modelValue":a[0]||(a[0]=e=>h.name=e),placeholder:"输入单词"},null,512)),[[e.vModelText,h.name]]):(e.openBlock(),e.createElementBlock("view",{key:0,class:"word-name"},e.toDisplayString(r.value.name||"加载中..."),1)),g.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"pos-selection"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(x,((t,o)=>e.createElementVNode("view",{key:o,class:e.normalizeClass(["pos-item-small",{active:h.pos.includes(t.value)}]),onClick:e=>(e=>{const t=h.pos.indexOf(e);-1===t?h.pos.push(e):h.pos.splice(t,1)})(t.value)},e.toDisplayString(t.label),11,["onClick"]))),64))])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"word-pos-tag"},e.toDisplayString(r.value.pos||""),1))]),u.value||v.value.show||g.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"refresh-btn",onClick:W},[e.createElementVNode("text",{class:"refresh-icon"},"↻")]))],2),u.value||v.value.show?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("scroll-view",{key:0,"scroll-y":"",class:"content-area"},[e.createElementVNode("view",{class:"detail-section"},[e.createElementVNode("view",{class:"section-title"},"中文释义"),g.value?e.withDirectives((e.openBlock(),e.createElementBlock("textarea",{key:1,class:"edit-textarea","onUpdate:modelValue":a[1]||(a[1]=e=>h.meaning=e),placeholder:"输入中文释义"},null,512)),[[e.vModelText,h.meaning]]):(e.openBlock(),e.createElementBlock("view",{key:0,class:"section-content chinese-meaning"},e.toDisplayString(r.value.meaning||"暂无释义"),1))]),e.createElementVNode("view",{class:"detail-section"},[e.createElementVNode("view",{class:"section-title"},[e.createTextVNode(" 例句 "),!g.value&&r.value.examples&&r.value.examples.length?(e.openBlock(),e.createElementBlock("span",{key:0},"("+e.toDisplayString(r.value.examples.length)+")",1)):e.createCommentVNode("",!0),g.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"add-btn",onClick:j},"+ 添加例句")):e.createCommentVNode("",!0)]),!g.value&&r.value.examples&&r.value.examples.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"example-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value.examples,((t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"example-item",key:o},[e.createElementVNode("view",{class:"example-number"},e.toDisplayString(o+1),1),e.createElementVNode("view",{class:"example-content"},[e.createElementVNode("view",{class:"example-en"},[e.createElementVNode("text",{innerHTML:y(t.en,r.value.name)},null,8,["innerHTML"])]),e.createElementVNode("view",{class:"example-zh"},e.toDisplayString(t.zh),1)])])))),128))])):e.createCommentVNode("",!0),g.value?(e.openBlock(),e.createElementBlock("view",{key:1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.examples,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"example-edit-item"},[e.createElementVNode("view",{class:"example-edit-header"},[e.createElementVNode("view",{class:"example-number"},e.toDisplayString(o+1),1),e.createElementVNode("view",{class:"example-delete",onClick:e=>(e=>{h.examples.splice(e,1)})(o)},"删除",8,["onClick"])]),e.withDirectives(e.createElementVNode("textarea",{class:"edit-textarea","onUpdate:modelValue":e=>t.en=e,placeholder:"输入英文例句"},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.en]]),e.withDirectives(e.createElementVNode("textarea",{class:"edit-textarea","onUpdate:modelValue":e=>t.zh=e,placeholder:"输入中文翻译"},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.zh]])])))),128))])):e.createCommentVNode("",!0),!g.value&&(!r.value.examples||0===r.value.examples.length)||g.value&&0===h.examples.length?(e.openBlock(),e.createElementBlock("view",{key:2,class:"empty-module"}," 暂无例句 ")):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"detail-section"},[e.createElementVNode("view",{class:"section-title"},[e.createTextVNode(" 相关单词 "),!g.value&&r.value.relatedWords&&r.value.relatedWords.length?(e.openBlock(),e.createElementBlock("span",{key:0},"("+e.toDisplayString(r.value.relatedWords.length)+")",1)):e.createCommentVNode("",!0),g.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"add-btn",onClick:q},"+ 添加相关单词")):e.createCommentVNode("",!0)]),!g.value&&r.value.relatedWords&&r.value.relatedWords.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"related-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value.relatedWords,((o,a)=>(e.openBlock(),e.createElementBlock("view",{class:"related-item",key:a,onClick:e=>(e=>{if(!e)return t("error","at pages/worddetail/index.vue:1068","无效的单词ID，无法跳转"),void uni.showToast({title:"无法加载单词",icon:"none"});t("log","at pages/worddetail/index.vue:1076",`准备跳转到单词ID: ${e}，类型: ${typeof e}`),k[e]&&(t("log","at pages/worddetail/index.vue:1080",`清除ID为${e}的缓存`),delete k[e]);try{const o=uni.getStorageSync(C);if(o){const a=JSON.parse(o),r=(Array.isArray(a)?a:a&&Array.isArray(a.words)?a.words:[]).find((t=>t.id===e));if(r)t("log","at pages/worddetail/index.vue:1095",`目标单词存在于本地单词库中: ${r.name}`);else{t("warn","at pages/worddetail/index.vue:1097",`ID为${e}的单词在本地单词库中不存在`);const o=n.find((t=>t.id===e));if(o)return t("warn","at pages/worddetail/index.vue:1102",`ID为${e}的单词在mockWords中存在(${o.name})，但不在本地单词库中`),void uni.showModal({title:"单词不存在",content:`您尝试访问的单词"${o.name}"不在您的单词库中，是否仍要继续？`,confirmText:"继续",cancelText:"取消",success:t=>{t.confirm&&B(e)}})}}}catch(o){t("error","at pages/worddetail/index.vue:1121","检查本地单词库出错:",o)}B(e)})(o.id)},[e.createElementVNode("view",{class:"related-word-main"},[e.createElementVNode("text",{class:"related-word-name"},e.toDisplayString(o.name),1),o.pos?(e.openBlock(),e.createElementBlock("text",{key:0,class:"related-pos"},e.toDisplayString(o.pos),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"related-word-meaning"},e.toDisplayString(o.meaning),1),e.createElementVNode("text",{class:"related-arrow"},"→")],8,["onClick"])))),128))])):e.createCommentVNode("",!0),g.value?(e.openBlock(),e.createElementBlock("view",{key:1},[F.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"related-word-search"},[e.createElementVNode("view",{class:"search-header"},[e.withDirectives(e.createElementVNode("input",{class:"search-input","onUpdate:modelValue":a[2]||(a[2]=e=>U.value=e),placeholder:"输入单词名称搜索",focus:"",onInput:J},null,544),[[e.vModelText,U.value]]),e.createElementVNode("text",{class:"search-close",onClick:z},"关闭")]),R.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"search-results"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(R.value,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"search-result-item",onClick:e=>{return o=t,void(h.relatedWords.some((e=>e.id===o.id))?uni.showToast({title:"已添加该单词",icon:"none",duration:1e3}):o.id!==r.value.id?(h.relatedWords.push({id:o.id,name:o.name,pos:o.pos,meaning:o.meaning}),U.value="",R.value=[],F.value=!1,uni.showToast({title:"添加成功",icon:"success",duration:1e3})):uni.showToast({title:"不能添加当前单词",icon:"none",duration:1e3}));var o}},[e.createElementVNode("view",{class:"result-word-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"result-word-pos"},e.toDisplayString(t.pos),1),e.createElementVNode("view",{class:"result-word-meaning"},e.toDisplayString(t.meaning),1)],8,["onClick"])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-search-results"},[e.createElementVNode("text",null,e.toDisplayString(U.value?"没有找到匹配的单词":"请输入单词名称进行搜索"),1)]))])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.relatedWords,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"related-edit-item"},[e.createElementVNode("view",{class:"related-edit-header"},[e.createElementVNode("view",{class:"related-edit-number"},e.toDisplayString(o+1),1),e.createElementVNode("view",{class:"related-edit-delete",onClick:e=>(e=>{h.relatedWords.splice(e,1)})(o)},"删除",8,["onClick"])]),e.withDirectives(e.createElementVNode("input",{class:"edit-input","onUpdate:modelValue":e=>t.name=e,placeholder:"相关单词",disabled:""},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.name]]),e.withDirectives(e.createElementVNode("input",{class:"edit-input","onUpdate:modelValue":e=>t.pos=e,placeholder:"词性",disabled:""},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.pos]]),e.withDirectives(e.createElementVNode("input",{class:"edit-input","onUpdate:modelValue":e=>t.meaning=e,placeholder:"中文释义",disabled:""},null,8,["onUpdate:modelValue"]),[[e.vModelText,t.meaning]])])))),128))])):e.createCommentVNode("",!0),!g.value&&(!r.value.relatedWords||0===r.value.relatedWords.length)||g.value&&0===h.relatedWords.length?(e.openBlock(),e.createElementBlock("view",{key:2,class:"empty-module"}," 暂无相关单词 ")):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"detail-section"},[e.createElementVNode("view",{class:"section-title"},[e.createTextVNode(" 注意事项 "),g.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"add-btn",onClick:$},"+ 添加注意事项")):e.createCommentVNode("",!0)]),!g.value&&r.value.notes&&r.value.notes.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"notes-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value.notes,((t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"note-item",key:o},[e.createElementVNode("view",{class:"note-bullet"},"•"),e.createElementVNode("view",{class:"note-content"},e.toDisplayString(t),1)])))),128))])):e.createCommentVNode("",!0),g.value?(e.openBlock(),e.createElementBlock("view",{key:1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.notes,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"note-edit-item"},[e.createElementVNode("view",{class:"note-edit-header"},[e.createElementVNode("view",{class:"note-bullet"},"•"),e.createElementVNode("view",{class:"note-edit-delete",onClick:e=>(e=>{h.notes.splice(e,1)})(o)},"删除",8,["onClick"])]),e.withDirectives(e.createElementVNode("textarea",{class:"edit-textarea","onUpdate:modelValue":e=>h.notes[o]=e,placeholder:"输入注意事项"},null,8,["onUpdate:modelValue"]),[[e.vModelText,h.notes[o]]])])))),128))])):!g.value||h.notes&&0!==h.notes.length?!g.value&&r.value.commonErrors&&r.value.commonErrors.length>0?(e.openBlock(),e.createElementBlock("view",{key:3,class:"empty-module"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value.commonErrors,((t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"note-item",key:o},[e.createElementVNode("view",{class:"note-bullet error-bullet"},"✘"),e.createElementVNode("view",{class:"note-content"},e.toDisplayString(t),1)])))),128))])):g.value||r.value.notes&&0!==r.value.notes.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:4,class:"empty-module"}," 暂无注意事项 ")):(e.openBlock(),e.createElementBlock("view",{key:2,class:"empty-module"}," 暂无注意事项 "))])])),u.value&&!v.value.show?(e.openBlock(),e.createElementBlock("view",{key:1,class:"skeleton"},[e.createElementVNode("view",{class:"skeleton-section"},[e.createElementVNode("view",{class:"skeleton-title"}),e.createElementVNode("view",{class:"skeleton-content"})]),e.createElementVNode("view",{class:"skeleton-section"},[e.createElementVNode("view",{class:"skeleton-title"}),e.createElementVNode("view",{class:"skeleton-content"}),e.createElementVNode("view",{class:"skeleton-content"})]),e.createElementVNode("view",{class:"skeleton-section"},[e.createElementVNode("view",{class:"skeleton-title"}),e.createElementVNode("view",{class:"skeleton-item"}),e.createElementVNode("view",{class:"skeleton-item"})])])):e.createCommentVNode("",!0),v.value.show?(e.openBlock(),e.createElementBlock("view",{key:2,class:"error-container"},[e.createElementVNode("view",{class:"error-icon"},"❌"),e.createElementVNode("view",{class:"error-message"},e.toDisplayString(v.value.message),1),e.createElementVNode("view",{class:"error-actions"},[e.createElementVNode("button",{class:"retry-btn",onClick:S},"重试"),e.createElementVNode("button",{class:"back-btn",onClick:T},"返回")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["actions",{disabled:u.value||v.value.show}])},[g.value?(e.openBlock(),e.createElementBlock("button",{key:1,class:"action-btn save",onClick:A,"hover-class":"btn-hover"},"保存")):(e.openBlock(),e.createElementBlock("button",{key:0,class:"action-btn edit",onClick:D,"hover-class":"btn-hover",disabled:u.value||v.value.show},"编辑",8,["disabled"])),g.value?(e.openBlock(),e.createElementBlock("button",{key:3,class:"action-btn cancel",onClick:I,"hover-class":"btn-hover"},"取消")):(e.openBlock(),e.createElementBlock("button",{key:2,class:"action-btn delete",onClick:M,"hover-class":"btn-hover",disabled:u.value||v.value.show},"删除",8,["disabled"]))],2)]))}};const T=k({name:"LoadingError",props:{show:{type:Boolean,default:!1},message:{type:String,default:"加载失败"}},emits:["retry","dismiss"]},[["render",function(t,o,a,n,r,s){return a.show?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-error"},[e.createElementVNode("view",{class:"error-container"},[e.createElementVNode("text",{class:"error-icon"},"!"),e.createElementVNode("text",{class:"error-text"},e.toDisplayString(a.message||"加载失败"),1),e.createElementVNode("view",{class:"error-actions"},[e.createElementVNode("button",{class:"retry-btn",onClick:o[0]||(o[0]=e=>t.$emit("retry"))},"重试"),e.createElementVNode("button",{class:"dismiss-btn",onClick:o[1]||(o[1]=e=>t.$emit("dismiss"))},"关闭")])])])):e.createCommentVNode("",!0)}],["__scopeId","data-v-16d04f32"]]);const B=k({components:{LoadingError:T},setup(){const o=e.ref([]),a=e.ref(""),n=e.ref(!1),r=e.ref(!1),s=e.ref([]),l=async()=>{try{if(!a.value)return void(s.value=o.value);const n=await(e=a.value,new Promise((o=>{try{const a=g();if(!e)return void o(a);const n=e.toLowerCase(),r=a.filter((e=>e.content&&e.content.toLowerCase().includes(n)||e.note&&e.note.toLowerCase().includes(n)));t("log","at services/errorbook.js:360",`搜索关键词 "${e}" 找到 ${r.length} 条结果`),o(r)}catch(a){t("error","at services/errorbook.js:363","搜索错误记录失败:",a),o([])}})));s.value=n}catch(n){t("error","at pages/errorbook/index.vue:191","搜索错误:",n),s.value=[]}var e},i=e.ref(!1),d=e.ref(!1),m=e.ref(!1),w=e.ref(!1),h=e.ref({id:"",content:"",translation:"",word:"",note:"",createTime:"",updateTime:""}),x=e.ref(!1),f=e.ref("数据加载失败"),y=()=>{i.value=!1,d.value=!1,k()},k=()=>{h.value={id:"",content:"",translation:"",word:"",note:"",createTime:"",updateTime:""}},E=async()=>{if(!n.value){t("log","at pages/errorbook/index.vue:271","开始加载错误记录数据..."),n.value=!0;try{t("log","at pages/errorbook/index.vue:275","调用错误记录服务 getErrorList()...");const e=await v();t("log","at pages/errorbook/index.vue:277","收到错误记录数据:",e),e&&e.length>0&&t("log","at pages/errorbook/index.vue:281","第一条错误记录示例:",JSON.stringify(e[0])),o.value=e,s.value=e,t("log","at pages/errorbook/index.vue:287","加载了错误本数据，条数:",e.length),N()}catch(e){t("error","at pages/errorbook/index.vue:290","加载错误本数据失败:",e),x.value=!0,f.value="加载数据失败，请重试"}finally{n.value=!1,r.value=!1}}},N=()=>{try{const e=getApp().globalData||{},a=e.errorBookCount||0;e.errorBookCount=o.value.length,t("log","at pages/errorbook/index.vue:311",`已更新主页错误本计数: ${a} -> ${e.errorBookCount}`),"function"==typeof e.updateCounters&&(e.updateCounters(),t("log","at pages/errorbook/index.vue:316","已触发全局计数器更新")),uni.$emit("errorbook-count-updated",{count:o.value.length}),t("log","at pages/errorbook/index.vue:323","已发送错题本计数更新事件")}catch(e){t("error","at pages/errorbook/index.vue:325","更新主页错误本计数失败:",e)}};return e.onMounted((()=>{E()})),{errorList:o,filteredErrorList:s,searchText:a,isLoading:n,isRefreshing:r,showAddModal:i,showEditModal:d,showDetailModal:m,showDeleteModal:w,currentError:h,onSearch:async e=>{a.value=e.detail.value,await l()},clearSearch:async()=>{a.value="",s.value=o.value},editError:e=>{h.value={...e},m.value=!1,d.value=!0,i.value=!0},viewErrorDetail:async e=>{try{const a=await(o=e.id,new Promise((a=>{try{const e=g().find((e=>e.id===o))||null;e?t("log","at services/errorbook.js:144","找到错误记录:",o):t("log","at services/errorbook.js:146","未找到错误记录:",o),a(e)}catch(e){t("error","at services/errorbook.js:151","获取错误记录详情失败:",e),a(null)}})));a?(h.value=a,m.value=!0):uni.showToast({title:"记录不存在或已被删除",icon:"none"})}catch(a){t("error","at pages/errorbook/index.vue:358","获取错误详情失败:",a),uni.showToast({title:"获取详情失败",icon:"none"})}var o},confirmDelete:e=>{h.value={...e},w.value=!0},deleteError:async()=>{try{await(e=h.value.id,new Promise((o=>{try{const n=uni.getStorageSync(p);if(!n)return t("warn","at services/errorbook.js:296","没有找到错误记录数据"),void o(!1);try{const a=JSON.parse(n);if(!Array.isArray(a))return t("warn","at services/errorbook.js:305","错误记录数据格式不正确"),void o(!1);const r=a.filter((t=>t.id!==e));if(r.length===a.length)return t("warn","at services/errorbook.js:314","未找到要删除的错误记录:",e),void o(!1);uni.setStorageSync(p,JSON.stringify(r)),t("log","at services/errorbook.js:321","删除错误记录成功, ID:",e),o(!0)}catch(a){t("error","at services/errorbook.js:325","解析错误记录数据失败:",a),o(!1)}}catch(n){t("error","at services/errorbook.js:329","删除错误记录失败:",n),o(!1)}})))?(o.value.length>0&&(o.value=o.value.filter((e=>e.id!==h.value.id)),s.value=s.value.filter((e=>e.id!==h.value.id)),N(),t("log","at pages/errorbook/index.vue:387","本地数据和首页计数已更新")),await E(),w.value=!1,uni.showToast({title:"删除成功",icon:"success"})):uni.showToast({title:"删除失败",icon:"none"})}catch(a){t("error","at pages/errorbook/index.vue:405","删除错误记录失败:",a),uni.showToast({title:"删除失败",icon:"none"})}var e},saveError:async()=>{var e;if(h.value.content.trim())try{let n=!1;if(h.value.id){const e=await(e=>new Promise((o=>{try{const n=uni.getStorageSync(p);if(!n)return t("warn","at services/errorbook.js:217","没有找到错误记录数据"),void o(!1);try{const a=JSON.parse(n);if(!Array.isArray(a))return t("warn","at services/errorbook.js:226","错误记录数据格式不正确"),void o(!1);const r=a.findIndex((t=>t.id===e.id));if(-1===r)return t("warn","at services/errorbook.js:235","未找到要更新的错误记录:",e.id),void o(!1);const s=a[r],l={...s};"content"in s?l.content=e.content:"title"in s&&(l.title=e.content),l.note=e.note||s.note||"",l.updateTime=(new Date).toISOString(),a[r]=l,uni.setStorageSync(p,JSON.stringify(a)),t("log","at services/errorbook.js:271","更新错误记录成功, ID:",e.id),o(!0)}catch(a){t("error","at services/errorbook.js:275","解析错误记录数据失败:",a),o(!1)}}catch(n){t("error","at services/errorbook.js:279","更新错误记录失败:",n),o(!1)}})))(h.value);if(!e)return void uni.showToast({title:"更新失败",icon:"none"});{const e=o.value.findIndex((e=>e.id===h.value.id));if(-1!==e){o.value[e]={...h.value};const a=s.value.findIndex((e=>e.id===h.value.id));-1!==a&&(s.value[a]={...h.value}),t("log","at pages/errorbook/index.vue:469","已更新本地记录")}uni.showToast({title:"更新成功",icon:"success"})}}else{const r=await(e=h.value,new Promise((o=>{try{const n=uni.getStorageSync(p);let r=[];try{n&&(r=JSON.parse(n),Array.isArray(r)||(r=[]))}catch(a){t("error","at services/errorbook.js:177","解析现有数据失败，将创建新的数组",a),r=[]}const s={id:c(),content:e.content||"",translation:"",word:"",note:e.note||"",createTime:(new Date).toISOString()};r.unshift(s),uni.setStorageSync(p,JSON.stringify(r)),t("log","at services/errorbook.js:196","添加错误记录成功, ID:",s.id),o(s)}catch(n){t("error","at services/errorbook.js:200","添加错误记录失败:",n),o(null)}})));if(!r)return void uni.showToast({title:"添加失败",icon:"none"});r&&(n=!0,o.value.unshift(r),a.value||(s.value=[...o.value]),N(),t("log","at pages/errorbook/index.vue:442","已添加新记录并更新首页计数")),uni.showToast({title:"添加成功",icon:"success"})}await E(),y()}catch(n){t("error","at pages/errorbook/index.vue:490","保存错误记录失败:",n),uni.showToast({title:"操作失败",icon:"none"})}else uni.showToast({title:"内容不能为空",icon:"none"})},formatDate:e=>u(e),loadData:E,closeModal:y,showError:x,errorMessage:f,onScroll:e=>{},onPulling:()=>{t("log","at pages/errorbook/index.vue:228","用户下拉中...")},onRefresh:()=>{t("log","at pages/errorbook/index.vue:232","触发刷新"),r.value=!0,E()},onRestore:()=>{t("log","at pages/errorbook/index.vue:238","刷新完成，控件恢复"),r.value=!1},onAbort:()=>{t("log","at pages/errorbook/index.vue:243","用户终止了刷新"),r.value=!1},handleRetry:()=>{x.value=!1,E()},dismissError:()=>{x.value=!1}}}},[["render",function(t,o,a,n,r,s){const l=e.resolveComponent("loading-error");return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"content-container"},[e.createElementVNode("view",{class:"search-bar"},[e.createElementVNode("view",{class:"search-box"},[e.createElementVNode("text",{class:"icon"},"🔍"),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>n.searchText=e),placeholder:"搜索",onInput:o[1]||(o[1]=(...e)=>n.onSearch&&n.onSearch(...e))},null,544),[[e.vModelText,n.searchText]]),n.searchText?(e.openBlock(),e.createElementBlock("text",{key:0,class:"icon",onClick:o[2]||(o[2]=(...e)=>n.clearSearch&&n.clearSearch(...e))},"✖")):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"action-bar"},[e.createElementVNode("button",{class:"add-btn",onClick:o[3]||(o[3]=e=>n.showAddModal=!0)},[e.createElementVNode("text",{class:"icon"},"+"),e.createTextVNode(" 添加 ")])]),e.createElementVNode("scroll-view",{class:"error-list","scroll-y":"",onScroll:o[5]||(o[5]=(...e)=>n.onScroll&&n.onScroll(...e)),"scroll-with-animation":!0,"enable-back-to-top":!0,"show-scrollbar":!0,"refresher-enabled":!0,"refresher-triggered":n.isRefreshing,onRefresherpulling:o[6]||(o[6]=(...e)=>n.onPulling&&n.onPulling(...e)),onRefresherrefresh:o[7]||(o[7]=(...e)=>n.onRefresh&&n.onRefresh(...e)),onRefresherrestore:o[8]||(o[8]=(...e)=>n.onRestore&&n.onRestore(...e)),onRefresherabort:o[9]||(o[9]=(...e)=>n.onAbort&&n.onAbort(...e))},[n.errorList&&n.errorList.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(n.filteredErrorList,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"error-item"},[e.createElementVNode("view",{class:"error-content",onClick:e=>n.viewErrorDetail(t)},[e.createElementVNode("view",{class:"error-title"},e.toDisplayString(t.content),1),t.note?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-note"},"备注: "+e.toDisplayString(t.note),1)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"error-date"},e.toDisplayString(n.formatDate(t.createTime)),1)],8,["onClick"]),e.createElementVNode("view",{class:"error-actions"},[e.createElementVNode("text",{class:"icon icon-edit",onClick:e=>n.editError(t)},"✏️",8,["onClick"]),e.createElementVNode("text",{class:"icon icon-delete",onClick:e=>n.confirmDelete(t)},"🗑️",8,["onClick"])])])))),128)):0!==n.errorList.length||n.isLoading?n.filteredErrorList&&0===n.filteredErrorList.length&&n.searchText&&!n.isLoading?(e.openBlock(),e.createElementBlock("view",{key:2,class:"empty-result"},[e.createElementVNode("image",{src:y,mode:"aspectFit"}),e.createElementVNode("text",null,"没有找到匹配的错误记录"),e.createElementVNode("button",{class:"small-btn",onClick:o[4]||(o[4]=(...e)=>n.clearSearch&&n.clearSearch(...e))},"清除搜索")])):e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-result"},[e.createElementVNode("image",{src:y,mode:"aspectFit"}),e.createElementVNode("text",null,"错题本为空"),e.createElementVNode("text",{class:"empty-tip"},'点击"添加"按钮添加内容')]))],40,["refresher-triggered"])]),n.showAddModal?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal"},[e.createElementVNode("view",{class:"modal-content"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",null,e.toDisplayString(n.showEditModal?"编辑错误记录":"添加错误记录"),1),e.createElementVNode("text",{class:"icon",onClick:o[10]||(o[10]=(...e)=>n.closeModal&&n.closeModal(...e))},"✖")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"内容"),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":o[11]||(o[11]=e=>n.currentError.content=e),placeholder:"输入错误内容",class:"textarea"},null,512),[[e.vModelText,n.currentError.content]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"备注"),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":o[12]||(o[12]=e=>n.currentError.note=e),placeholder:"输入备注（可选）",class:"textarea"},null,512),[[e.vModelText,n.currentError.note]])])]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"cancel-btn",onClick:o[13]||(o[13]=(...e)=>n.closeModal&&n.closeModal(...e))},"取消"),e.createElementVNode("button",{class:"submit-btn",onClick:o[14]||(o[14]=(...e)=>n.saveError&&n.saveError(...e))},"保存")])])])):e.createCommentVNode("",!0),n.showDeleteModal?(e.openBlock(),e.createElementBlock("view",{key:1,class:"modal"},[e.createElementVNode("view",{class:"modal-content"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",null,"删除错误记录"),e.createElementVNode("text",{class:"icon",onClick:o[15]||(o[15]=e=>n.showDeleteModal=!1)},"✖")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("text",null,"确定要删除这个错误记录吗？"),e.createElementVNode("text",{class:"delete-title"},e.toDisplayString(n.currentError.content),1)]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"cancel-btn",onClick:o[16]||(o[16]=e=>n.showDeleteModal=!1)},"取消"),e.createElementVNode("button",{class:"delete-btn",onClick:o[17]||(o[17]=(...e)=>n.deleteError&&n.deleteError(...e))},"删除")])])])):e.createCommentVNode("",!0),n.showDetailModal?(e.openBlock(),e.createElementBlock("view",{key:2,class:"modal"},[e.createElementVNode("view",{class:"modal-content detail-modal"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",null,"错误详情"),e.createElementVNode("text",{class:"icon",onClick:o[18]||(o[18]=e=>n.showDetailModal=!1)},"✖")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("view",{class:"detail-title"},e.toDisplayString(n.currentError.content),1),n.currentError.note?(e.openBlock(),e.createElementBlock("view",{key:0,class:"detail-note"},[e.createElementVNode("text",{class:"note-label"},"备注："),e.createTextVNode(" "+e.toDisplayString(n.currentError.note),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"detail-date"},"记录时间："+e.toDisplayString(n.formatDate(n.currentError.createTime)),1),n.currentError.updateTime?(e.openBlock(),e.createElementBlock("view",{key:1,class:"detail-date"},"更新时间："+e.toDisplayString(n.formatDate(n.currentError.updateTime)),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"cancel-btn",onClick:o[19]||(o[19]=e=>n.showDetailModal=!1)},"关闭"),e.createElementVNode("button",{class:"edit-btn",onClick:o[20]||(o[20]=e=>n.editError(n.currentError))},"编辑")])])])):e.createCommentVNode("",!0),e.createVNode(l,{show:n.showError,message:n.errorMessage,onRetry:n.handleRetry,onDismiss:n.dismissError},null,8,["show","message","onRetry","onDismiss"])])}],["__scopeId","data-v-06cd56aa"]]);__definePage("pages/index/index",f),__definePage("pages/wordlist/index",N),__definePage("pages/add/index",V),__definePage("pages/settings/index",b),__definePage("pages/worddetail/index",S),__definePage("pages/errorbook/index",B);const D="reciter_words",A=[{id:1,name:"apple",pos:"n.",meaning:"苹果"},{id:2,name:"banana",pos:"n.",meaning:"香蕉"},{id:3,name:"book",pos:"n.",meaning:"书籍"},{id:4,name:"cat",pos:"n.",meaning:"猫"},{id:5,name:"dog",pos:"n.",meaning:"狗"},{id:6,name:"eat",pos:"v.",meaning:"吃"},{id:7,name:"friend",pos:"n.",meaning:"朋友"},{id:8,name:"go",pos:"v.",meaning:"去"},{id:9,name:"happy",pos:"adj.",meaning:"快乐的"},{id:10,name:"in",pos:"prep.",meaning:"在...里"},{id:11,name:"jump",pos:"v.",meaning:"跳跃"},{id:12,name:"kind",pos:"adj.",meaning:"友善的"},{id:13,name:"love",pos:"v./n.",meaning:"爱；喜爱"},{id:14,name:"moon",pos:"n.",meaning:"月亮"},{id:15,name:"nice",pos:"adj.",meaning:"好的；友好的"},{id:16,name:"open",pos:"v./adj.",meaning:"打开；开着的"},{id:17,name:"pen",pos:"n.",meaning:"钢笔"},{id:18,name:"question",pos:"n.",meaning:"问题"},{id:19,name:"run",pos:"v.",meaning:"跑"},{id:20,name:"sun",pos:"n.",meaning:"太阳"},{id:21,name:"time",pos:"n.",meaning:"时间"},{id:22,name:"umbrella",pos:"n.",meaning:"雨伞"},{id:23,name:"very",pos:"adv.",meaning:"非常"},{id:24,name:"water",pos:"n.",meaning:"水"},{id:25,name:"xylophone",pos:"n.",meaning:"木琴"},{id:26,name:"yellow",pos:"adj.",meaning:"黄色的"},{id:27,name:"zoo",pos:"n.",meaning:"动物园"}],I={globalData:{editWordId:null,editMode:null},onLaunch:function(){t("log","at App.vue:42","App Launch"),this.initData(),this.setupErrorHandling(),this.suppressNetworkErrors(),this.setupEmergencyUnlock()},onShow:function(){t("log","at App.vue:57","App Show")},onHide:function(){t("log","at App.vue:60","App Hide")},methods:{initData(){t("log","at App.vue:65","正在初始化应用数据...");try{const o=uni.getStorageSync(D);if(o)try{const e=JSON.parse(o);"object"==typeof e&&!0===e.forceEmpty?t("log","at App.vue:79","数据已被清空，保持空状态"):Array.isArray(e)?t("log","at App.vue:81","本地存储数据有效，单词数量:",e.length):e&&"object"==typeof e&&Array.isArray(e.words)?t("log","at App.vue:83","本地存储数据有效（新格式），单词数量:",e.words.length):t("log","at App.vue:85","本地数据格式无效，但不做自动修复")}catch(e){t("error","at App.vue:89","解析本地存储数据失败:",e)}else t("log","at App.vue:73","本地存储没有单词数据")}catch(o){t("error","at App.vue:93","初始化数据检查失败:",o)}},setupErrorHandling(){uni.onError((e=>{t("error","at App.vue:101","应用发生错误:",e)})),"undefined"!=typeof window&&window.addEventListener("unhandledrejection",(e=>{t("error","at App.vue:107","未处理的Promise异常:",e.reason),e.preventDefault()}));const e=uni.navigateTo;uni.navigateTo=o=>{t("log","at App.vue:116","页面导航:",o.url);const a=o.fail;return o.fail=e=>{t("error","at App.vue:119","页面导航失败:",e),a?a(e):uni.showToast({title:"页面跳转失败，请重试",icon:"none"})},e(o)}},suppressNetworkErrors(){t("log","at App.vue:135","增强版：禁用所有网络错误提示和处理"),uni.getNetworkType=function(e){return t("log","at App.vue:139","拦截到 getNetworkType 调用"),e&&e.success&&e.success({networkType:"wifi",errMsg:"getNetworkType:ok"}),{errMsg:"getNetworkType:ok",networkType:"wifi"}},uni.onNetworkStatusChange=function(e){t("log","at App.vue:154","拦截到 onNetworkStatusChange 调用"),e&&e({isConnected:!0,networkType:"wifi"})},"undefined"!=typeof plus&&plus.networkinfo&&(plus.networkinfo.getCurrentType,plus.networkinfo.getCurrentType=function(){return t("log","at App.vue:167","拦截 plus.networkinfo.getCurrentType"),plus.networkinfo.CONNECTION_WIFI});const e=uni.request;uni.request=function(o){if(t("log","at App.vue:175","拦截到 request 调用:",o.url||"未指定URL"),!o.url||o.url.startsWith("local://")||o.url.includes("mock"))return t("log","at App.vue:178","本地请求，模拟成功返回"),void setTimeout((()=>{o.success&&o.success({data:o.mockData||{status:"ok"},statusCode:200,errMsg:"request:ok"}),o.complete&&o.complete({errMsg:"request:ok"})}),100);const a={...o};a.fail=function(e){t("error","at App.vue:199","请求失败被拦截:",e),o.success&&o.success({data:o.mockData||{status:"ok",message:"已处理网络错误"},statusCode:200,errMsg:"request:ok"}),o.complete&&o.complete({errMsg:"request:ok"})},a.timeout||(a.timeout=5e3);try{return e(a)}catch(n){t("error","at App.vue:223","请求抛出异常:",n),o.success&&o.success({data:o.mockData||{status:"ok",message:"已处理网络异常"},statusCode:200,errMsg:"request:ok"}),o.complete&&o.complete({errMsg:"request:ok"})}},uni.setNetworkTimeout&&uni.setNetworkTimeout({request:5e3,connectSocket:5e3,uploadFile:5e3,downloadFile:5e3})},emergencyReset(){t("log","at App.vue:252","执行紧急数据重置");try{return uni.clearStorageSync(),t("log","at App.vue:256","已清除所有本地存储"),uni.setStorageSync(D,JSON.stringify(A)),t("log","at App.vue:260","已重新设置初始单词数据"),uni.showToast({title:"数据已重置",icon:"success",duration:2e3}),setTimeout((()=>{try{const e=getCurrentPages();e.length>1&&uni.navigateBack({delta:e.length-1})}catch(e){t("error","at App.vue:281","无法重启应用:",e)}}),2e3),!0}catch(e){return t("error","at App.vue:287","紧急重置失败:",e),uni.showToast({title:"重置失败，请手动重启应用",icon:"none",duration:2e3}),!1}},setupEmergencyUnlock(){t("log","at App.vue:301","设置紧急UI解锁机制");let e=Date.now();"undefined"!=typeof document&&(document.addEventListener("touchstart",(()=>{e=Date.now()})),document.addEventListener("click",(()=>{e=Date.now()}))),setInterval((()=>{Date.now()-e>5e3&&(t("log","at App.vue:325","检测到可能的UI锁定，尝试恢复..."),this.checkAndUnlockUI())}),2e3),"undefined"!=typeof window&&(window.addEventListener("error",(e=>(t("error","at App.vue:333","紧急处理器捕获到全局错误:",e.message),this.checkAndUnlockUI(),e.preventDefault(),!0)),!0),window.addEventListener("unhandledrejection",(e=>(t("error","at App.vue:340","紧急处理器捕获到未处理的Promise异常:",e.reason),this.checkAndUnlockUI(),e.preventDefault(),!0))))},checkAndUnlockUI(){try{const o=getCurrentPages(),a=o[o.length-1];if(t("log","at App.vue:355","当前页面路径:",a?a.route:"未知页面"),a&&a.route){if(t("log","at App.vue:359","检查页面是否存在错误弹窗"),a.$vm){if(a.$vm.showError){if(t("log","at App.vue:364","检测到错误弹窗处于显示状态，尝试关闭"),a.$vm.showError=!1,"function"==typeof a.$vm.loadData)try{a.$vm.loadData()}catch(e){t("error","at App.vue:372","重新加载数据失败:",e)}uni.showToast({title:"已自动恢复页面",icon:"none",duration:2e3})}if(a.$vm.wordList&&0===a.$vm.wordList.length&&a.$vm.showError&&a.$vm.mockWords){t("log","at App.vue:389","检测到页面错误状态，尝试恢复基本功能");const e=uni.getStorageSync("reciter_words");e&&"[]"===e?t("log","at App.vue:393","用户已清空数据，不自动恢复"):a.$vm.wordList=[...a.$vm.mockWords]}}a.route.includes("wordlist")&&(t("log","at App.vue:402","对单词列表页面进行特殊处理"),"function"==typeof uni.startPullDownRefresh&&(uni.startPullDownRefresh(),setTimeout((()=>{uni.stopPullDownRefresh()}),1e3)))}}catch(o){t("error","at App.vue:414","解锁UI过程中出错:",o)}}}};const{app:j,Vuex:$,Pinia:M}=function(){const t=e.createVueApp(I);return t.component("loading-error",T),{app:t}}();uni.Vuex=$,uni.Pinia=M,j.provide("__globalStyles",__uniConfig.styles),j._component.mpType="app",j._component.render=()=>{},j.mount("#app")}(Vue);
